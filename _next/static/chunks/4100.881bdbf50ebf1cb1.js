"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4100],{2635:(e,t,i)=>{i.d(t,{t:()=>n});let r={},n={get:e=>e,setMetaValue([e,t,i],a){let o=n.getResourceMeta(e,t),s=o?o[i]:void 0,l="function"==typeof a?a(s):a;r[e]={...r[e]||{},[t]:{...(r[e]||{})[t]||{},[i]:l}}},getResourceMeta:(e,t)=>{let i=r[e];if(i)return t?i[t]:i},load:async e=>fetch("string"==typeof e?e:e.id).then(e=>e.json()),requestStatus(e){}}},8576:(e,t,i)=>{i.d(t,{t:()=>n});let r=e=>{let t,i=new Set,r=(e,r)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=r??("object"!=typeof n||!n)?n:Object.assign({},t,n),i.forEach(i=>i(t,e))}},n=()=>t,a={setState:r,getState:n,getInitialState:()=>o,subscribe:e=>(i.add(e),()=>i.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),i.clear()}},o=t=e(r,n,a);return a},n=e=>e?r(e):r},15867:(e,t,i)=>{i.d(t,{t:()=>r});function r(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(e){e(i)}),(r=e.get("*"))&&r.slice().map(function(e){e(t,i)})}}}},20286:(e,t,i)=>{i.d(t,{n:()=>g,r:()=>f});var r=i(2635),n=Object.create,a=Object.defineProperty,o=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,l=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,u=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),d=(e,t,i)=>(i=null==e?{}:n(l(e)),((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(var n,l=s(t),u=0,d=l.length;u<d;u++)n=l[u],c.call(e,n)||n===i||a(e,n,{get:(e=>t[e]).bind(null,n),enumerable:!(r=o(t,n))||r.enumerable});return e})(!t&&e&&e.__esModule?i:a(i,"default",{value:e,enumerable:!0}),e)),h=u((e,t)=>{t.exports=function(e){var t=[];return e.replace(r,function(e,r,a){var o,s=r.toLowerCase();for(a=(o=a.match(n))?o.map(Number):[],"m"==s&&a.length>2&&(t.push([r].concat(a.splice(0,2))),s="l",r="m"==r?"l":"L");;){if(a.length==i[s])return a.unshift(r),t.push(a);if(a.length<i[s])throw Error("malformed path data");t.push([r].concat(a.splice(0,i[s])))}}),t};var i={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=/([astvzqmhlc])([^astvzqmhlc]*)/gi,n=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi}),p=u((e,t)=>{t.exports=function(e){var t=0,i=0,r=0,n=0;return e.map(function(e){var a=(e=e.slice())[0],o=a.toUpperCase();if(a!=o)switch(e[0]=o,a){case"a":e[6]+=r,e[7]+=n;break;case"v":e[1]+=n;break;case"h":e[1]+=r;break;default:for(var s=1;s<e.length;)e[s++]+=r,e[s++]+=n}switch(o){case"Z":r=t,n=i;break;case"H":r=e[1];break;case"V":n=e[1];break;case"M":r=t=e[1],n=i=e[2];break;default:r=e[e.length-2],n=e[e.length-1]}return e})}});function f(e=r.t,t,i,n=!1){let a=t.behavior||[],o=i?e.get(i):null;if(!o)return[];let s=o.behavior||[],l=!n&&a.includes("paged"),c=!l&&a.includes("continuous"),u=!l&&!c&&a.includes("individuals"),d=s.includes("facing-pages"),h=s.includes("non-paged");if(d||h||u||n)return[{id:o.id,type:"Canvas"}];let[p,m]=g(e,t);if(c)return p;let y=p.findIndex(e=>e.id===i);if(-1===y)return[];for(let e of m)if(e.includes(y))return e.map(e=>p[e]);return[{id:o.id,type:"Canvas"}]}function g(e=r.t,t,{disablePaging:i,skipNonPaged:n}={}){let a=t.behavior||[],o=a.includes("paged"),s=!o&&a.includes("continuous"),l=!o&&!s&&a.includes("individuals"),c="Manifest"===t.type?t.items:function e(t,i){let r=[];for(let n of i.items){if("SpecificResource"===n.type&&n.source?.type==="Canvas"){let[e,t]=function(e){var t;let[i,r]=e.split("#");return r&&((t=r).includes("xywh=")||t.includes("t="))?[i,r]:[e,""]}(n.source.id||"");t?r.push({id:e,type:"Canvas"}):r.push(n.source)}if("Range"===n.type&&r.push(...e(t,t.get(n))),"SpecificResource"===n.type){let e="string"==typeof n.source?n.source:n.source.id;r.push({id:e,type:"Canvas"})}}return r}(e,t);if(s)return[c,[c.map((e,t)=>t)]];if(l||!o||i)return[c,c.map((e,t)=>[t])];let u=[],d=[],h=()=>{d.length&&(u.push([...d]),d=[])},p=0,f=!1;for(let t=0;t<c.length;t++){let i=e.get(c[t]).behavior||[];if(i.includes("non-paged")){t===p&&p++,n||(h(),u.push([t]),h());continue}if(t===p||i.includes("facing-pages")){d.length&&(f=!0),h(),u.push([t]),h();continue}if(d.push(t),f){h(),f=!1;continue}d.length>1&&h()}return d.length&&h(),[c,u]}d(h(),1),d(p(),1)},27201:(e,t,i)=>{i.d(t,{n:()=>R});var r=i(2635),n=i(31458),a=i(8576),o=i(15867),s=i(27148);function l(e){for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t&&-1!==s.BM.indexOf(t))return!0;return!1}function c(e){return e["@id"]?e["@id"]:e.id?e.id:void 0}function u(e){if(!e||!e.profile||!c(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t&&-1!==s.HK.indexOf(t))return!0;return!1}function d(e){return e.endsWith("info.json")?e:e.endsWith("/")?`${e}info.json`:`${e}/info.json`}function h(e,t){if(t&&t.profile){let i=t.profile;if(i){let t=Array.isArray(i)?i:[i];if(t.includes(`level${e}`)||t.includes(`http://iiif.io/api/image/2/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/profiles/level${e}.json`))return!0;if(2===e){for(let e of t)if(s.I1.includes(e))return!0}if(1===e){for(let e of t)if(s.f6.includes(e))return!0}if(0===e){for(let e of t)if(s.BM.includes(e))return!0}}}return!1}function p(e){return u(e)?h(2,e)?2:h(1,e)?1:h(0,e)?0:null:null}function f(e){let t=e.service?Array.isArray(e.service)?e.service:[e.service]:[],i=t.length,r=[];for(let e=0;e<i;e++)u(t[e])&&r.push(t[e]);return r}function g(e){let t=e.replace(/(https?:\/\/)?(www.)?/i,"");return -1===t.indexOf("/")?t:t.split("/")[0]}function m(e,t,i){let r=function(e){let t=function(e,t=""){let{path:i,scheme:r,server:n,prefix:a}=function(e,t=""){let i=e.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!i)throw Error(`Invalid or unknown input ${e}`);let r=i[2],n=i[3],a=i[4];if("/"===a[0]&&(a=a.substring(1)),t.length>0){if("/"===t[0]&&(t=t.substring(1)),t!==a.substring(0,t.length))throw Error(`Path does not start with prefix (path: ${a}, prefix: ${t})`);a=a.substring(t.length)}return{scheme:r,server:n,path:a,prefix:t}}(e,t),o=i.split("/").reverse(),[s,l,c,u,...d]=o,h=d.reverse().filter(Boolean).join("/");if(1===o.length||""===s)return{type:"base",scheme:r,server:n,prefix:a,identifier:h};if("info.json"===s){let[,...e]=o;return{type:"info",scheme:r,server:n,prefix:a,identifier:e.reverse().filter(Boolean).join("/")}}if(void 0===r||void 0===n||void 0===i||void 0===u||void 0===c||void 0===l||void 0===s)throw Error("Invalid image service URL");let[p="",f=""]=s.split(".");return{type:"image",scheme:r,server:n,prefix:a,identifier:h,originalPath:i,region:function(e){try{if("full"===e)return{full:!0};if("square"===e)return{square:!0};let t=e.startsWith("pct:"),i=e.substr(4*!!t).split(",").map(e=>parseFloat(e));return{x:i[0],y:i[1],w:i[2],h:i[3],percent:t}}catch{throw Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+e)}}(u),size:function(e){let t={upscaled:!1,max:!1,confined:!1};if("^"===e[0]&&(t.upscaled=!0,e=e.slice(1)),"max"===e||"full"===e)return t.max=!0,t.serialiseAsFull="full"===e,t;if("!"===e[0]&&(t.confined=!0,e=e.slice(1)),"p"===e[0])return t.percentScale=parseFloat(e.slice(4)),t;let i=e.split(",").map(e=>e.trim());return i.length&&(""!==i[0]&&(t.width=parseInt(i[0],10)),""!==i[1]&&(t.height=parseInt(i[1],10))),t}(c),rotation:function(e){let t={angle:0};if("!"===e[0]&&(t.mirror=!0,e=e.substr(1)),t.angle=parseFloat(e)%360,Number.isNaN(t.angle))throw Error(`Invalid rotation ${e}`);return t}(l),quality:p,format:f}}(d(e.id));if("info"!==t.type)throw Error("Invalid service URL");let i=function(e){let t=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],i={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let e of t){var r;if("string"==typeof e&&(r=e,e=-1!==s.I1.indexOf(r)?s.do:-1!==s.f6.indexOf(r)?s.yg:s.rE),e){if(e.formats)for(let t of e.formats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.qualities)for(let t of e.qualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.supports)for(let t of e.supports)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea),e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea)}}if(e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);return i}(e);return{identifier:t.identifier,originalPath:"",server:t.server,prefix:t.prefix,scheme:t.scheme,type:"image",quality:-1===i.extraQualities.indexOf("default")?i.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}({"@context":3===e.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:d(c(e)),profile:null===e.level||void 0===e.level?"level0":`level${e.level}`,type:3===e.version?"ImageService3":"ImageService2"});if("image"!==r.type)throw Error("Invalid service");return r.size.max=!1,r.size.width=t,r.size.height=i,{id:function(e,t){let i=e.prefix.startsWith("/")?e.prefix.substring(1):e.prefix,r=`${e.scheme}://${e.server}/${i?`${i}/`:""}${e.identifier}`;if("base"===e.type)return r;if("info"===e.type)return`${r}/info.json`;let{size:n}=e,{region:a,rotation:o,format:s,quality:l}=e;return[r,function({x:e=0,y:t=0,w:i,h:r,full:n,square:a,percent:o}){if(n)return"full";if(a)return"square";if(void 0===i||void 0===r)throw Error("RegionParameter: invalid region");let s=`${e},${t},${i},${r}`;return o?`pct:${s}`:s}(a),function({max:e,percentScale:t,upscaled:i,confined:r,width:n,height:a,serialiseAsFull:o,version:s}){let l=[];return i&&l.push("^"),e?l.push(o?"full":"max"):(r&&l.push("!"),t&&l.push(`pct:${t}`),n&&l.push(`${n}`),l.push(","),a&&3===s&&l.push(`${a}`)),l.join("")}(n),`${o.mirror?"!":""}${(o.angle||0)%360}`,`${l}.${s}`].filter(Boolean).join("/")}(r),type:"fixed",width:t,height:i||e.height/(e.width||1)*t,unsafe:e.width>t}}function y(e){return -1!==(e["@context"]?Array.isArray(e["@context"])?e["@context"]:[e["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function v(e){let t=[],i=e.length;for(let r=0;r<i;r++){let i=e[r];if(!i)continue;let n=function(e){return u(e)?(e&&e.sizes?e.sizes:[]).map(t=>({id:c(e),type:"fixed-service",height:t.height,width:t.width,level:p(e),version:y(e)?3:2})):[]}(i);n.length&&t.push(...n);let a=function(e){if(!function(e){if(!u(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t){if(-1!==s.f6.indexOf(t))return!0}else{let e=[...t.supports||[],...t.extraFeatures||[]];if(-1!==e.indexOf("regionByPx")&&(-1!==e.indexOf("sizeByW")||-1!==e.indexOf("sizeByWh")))return!0}return!1}(e))return[];let t=[],i=Array.isArray(e.profile)?e.profile:[e.profile],r=i.length;for(let t=0;t<r;t++){let r=i[t];if(r&&"string"!=typeof r&&(r.maxHeight||r.maxWidth))return[{id:c(e),type:"variable",minWidth:0,minHeight:0,maxHeight:r.maxHeight||r.maxWidth,maxWidth:r.maxWidth||r.maxHeight,level:p(e),version:"http://iiif.io/api/image/3/context.json"===e["@context"]?3:2}]}if(e.tiles){let i=e.tiles.length;for(let r=0;r<i;r++){let i=e.tiles[r];i&&(i.height||i.width)&&t.push({id:c(e),type:"variable",minHeight:0,minWidth:0,maxHeight:i.height||i.width,maxWidth:i.width,level:p(e),version:y(e)?3:2})}}return t}(i);a.length&&t.push(...a)}return t}function b(e){let t=e.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(t&&t[4]&&t[5]){let i=t[1],r=parseInt(t[4],10),n=parseInt(t[5],10),a=t[7];if(("max"===i||"full"===i)&&r&&n&&a)return{type:"fixed",id:e,height:n,width:r}}return{type:"unknown",id:e}}function S(e){if("string"==typeof e)return b(e);let t=e["@type"]?e["@type"]:e.type?e.type:void 0;if("Image"!==t&&"sc:Image"!==t)return null;let i=c(e);return i?i&&e.width&&e.height?{id:i,type:"fixed",width:e.width,height:e.height,unsafe:!0}:b(i):null}var w=class{constructor(e={}){(0,n.t)(this,"config",{verificationsRequired:1,approximateServices:!1,enableFetching:!0,disableThrottling:!1}),(0,n.t)(this,"fetchingCount",0),(0,n.t)(this,"imageServices",{}),(0,n.t)(this,"knownImageServers",{}),this.config=Object.assign(this.config,e)}setConfig(e){Object.assign(this.config,e)}sample(e,t,i=!0){let r=g(c(e)),n=d(c(e)),a=this.knownImageServers[r];return this.imageServices[n]=Object.assign(e,{real:!0}),a||!e.tiles||l(e)?this.verify(e):(this.knownImageServers[r]={verifications:0,malformed:!1,root:r,preLoaded:i,sampledId:c(e),verified:!1,server:null,result:{context:e["@context"]||[],sampledProfile:e.profile,resourceServiceRatio:t&&e.height?t.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:function(e,t,i){let r=i.length,n=[];for(let t=0;t<r;t++){let r=i[t];if(!r)continue;let a=r.width;n.push(e/a)}return n}(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0)}preLoad(e,t=!0){this.knownImageServers[e.root]=e,t&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,t=!1,i=!1){let r=e?.source,n=g(c(e)),a=this.knownImageServers[n],o=d(c(e));return this.imageServices[o]?this.imageServices[o]||null:!(!this.config.approximateServices||!a||!a.result||!(r?.height||e.height)||!(r?.width||e.width)||!i&&(a.malformed||a.verifications<this.config.verificationsRequired)||e.source&&l(e.source))?(this.imageServices[o]||(this.imageServices[o]={"@context":a.result.context,"@id":c(e),id:c(e),protocol:"http://iiif.io/api/image",tiles:r?.tiles||function(e,t,i){let r=e>t?e:t,n=i.length,a=[];for(let e=0;e<n;e++){let t=i[e];if(!t||0===t.scaleFactors.length)continue;let n=t.scaleFactors[0];if(!n)continue;let o=r/n,s=[n];for(;o>=t.width;)n*=2,s.push(n),o/=2;a.push({...t,scaleFactors:s})}return a}(e.width,e.height,a.result.sampledTiles),sizes:r?.sizes||function(e,t,i){let r=i.length,n=[];for(let a=0;a<r;a++){let r=i[a];r&&n.push({width:Math.floor(e/r),height:Math.floor(t/r)})}return n}(Math.round(e.width/a.result.resourceServiceRatio),Math.round(e.height/a.result.resourceServiceRatio),a.result.sizeRatios),profile:r?.profile||a.result.sampledProfile,height:r?.height||e.height,width:r?.width||e.width,real:!1}),this.imageServices[o]||null):null}async getThumbnailFromResource(e,t,i=!0,r=[]){let n=e?await this.getImageCandidates(e,i):[];return function(e,t){let i=[],r=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},e),n=(e,t=0)=>r.explain?i.push(Array(t).fill(0).map(e=>"    ").join("")+e().trim()):void 0,a=[],o=[],s=null;n(()=>`Using configuration: ${JSON.stringify(r,null,2)}`);let l=(e,t)=>{let i;if(n(()=>"Swapping choice",3),i=r.width?r.width:r.maxWidth,e.height<=r.maxHeight&&e.width<=r.maxWidth&&e.height>=r.minHeight&&e.width>=r.minWidth&&(!t||Math.abs(e.width-i)<Math.abs(t.width-i))){if(r.preferFixedSize&&e.unsafe){n(()=>`We found an image that was marked as unsafe, but it was the best size. (${e.id})`,4),o.push(e);return}r.returnAllOptions&&t&&o.push(t),n(()=>`We found a new image that was the best size. (${e.id})`,4),s=e}else r.returnAllOptions&&o.push(e)};n(()=>`The input shows we have ${t.length} list(s) of candidates to choose from.`);let c=t.length;for(let e=0;e<c;e++){let i=t[e]();n(()=>`Candidate group ${e}: ${JSON.stringify(i,null,2)}`,1);let o=i.length;n(()=>`Checking candidate list number ${e} and found ${o} potential ways of creating image(s)`,1);for(let e=0;e<o;e++){let t=i[e];n(()=>`-> Checking candidate ${e}`,1),"unknown"===t.type&&r.atAnyCost&&(n(()=>'We\'ve found an unknown image type, adding this to the "last resort" list',2),a.push(t)),"fixed"===t.type&&(t.unsafe?(n(()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list',2),a.push(t)):(n(()=>"We've found a fixed size image, checking if it matches the request",2),l(t,s))),"fixed-service"===t.type&&(r.unsafeImageService?(n(()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)",2),l(m(t,r.width,r.height),s)):(n(()=>"Checking for an image from the tile source 3",2),l(m(t,t.width,t.height),s))),"variable"===t.type&&t.maxWidth&&l(m({id:t.id,type:"fixed-service",width:t.maxWidth,height:t.maxWidth,level:t.level,version:t.version},t.maxWidth),s)}if(s&&!r.returnAllOptions){if(s.unsafe||r.allowUnsafe)continue;n(()=>`We found a match in choice list number ${e}, no searching any more`);break}}return r.atAnyCost&&0===o.length?(n(()=>s?`We found an image! ${s.id} of type ${s.type}`:'We found no images, but "atAnyCost" is set, so returning that'),{best:s||a[0]||null,fallback:a.slice(1),log:i}):r.returnAllOptions?(n(()=>"Returning all options that we have found"),{best:(r.atAnyCost?s||o[0]||a[0]:s||o[0])||null,fallback:[...o,...a],log:i}):(n(()=>"Returning the best image that we found, and a fallback"),{best:s||o[0]||null,fallback:s?o:o.slice(1),log:i})}(t,[()=>r,()=>n])}async getImageCandidates(e,t=!0){if(t&&e&&e.height&&e.width)for(let t of f(e)){let i={id:c(t),width:t.width?t.width:e.width,height:t.height?t.height:e.height,source:t};await this.loadService(i)}return function(e,t=!0,i){let r=[],n=S(e);if(null===n)return r;if(r.push(n),t&&e&&e.width&&e.height){let t=[];for(let r of f(e)){let n={id:c(r),width:e.width,height:e.height};if(i.canLoadSync(n)){let r=i.loadServiceSync(n);r&&(r.height||(r.height=e.height),r.width||(r.width=e.width),t.push(...v([r])))}}if(t.length)return r.push(...t),r}return e.service&&r.push(...v(e.service)),r}(e,t,this)}async verify(e){let t=this.predict(e,!1,!0),i=await this.fetchService(c(e));if(!t)return!1;let r=t.height===i.height&&t.width===i.width&&t["@context"]===i["@context"]&&function(e,t){if(e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;let i=e.length,r=!0;for(let n=0;n<i;n++){let i=e[n],a=t[n];if(i.width!==a.width||i.height!==a.height){r=!1;break}}if(r)return!0;let n=0;for(let r=0;r<i;r++)for(let a=0;a<i;a++)if(e[r].width===t[a].width&&e[r].height===t[a].height){n++;break}return n===i}(t.sizes||[],i.sizes||[]);if(r){let t=g(c(e)),i=this.knownImageServers[t];i&&(i.verifications+=1,i.verifications>=this.config.verificationsRequired&&(i.verified=!0))}return r}canLoadSync(e){let t="string"==typeof e?e:c(e),i=d(t);if(this.imageServices[i])return!0;let r=this.knownImageServers[g(t)];return!!(r&&!r.malformed&&r.verifications>=this.config.verificationsRequired)}async markAsMalformed(e){return this.knownImageServers[g(c(e))].malformed=!0,this.loadService(e,!0)}async fetchService(e,t=!1){let i=d(e),r=this.imageServices[i];if(r&&(!t||r.real))return r;if(!this.config.enableFetching)throw Error("Fetching is not enabled");let n=await this.fetch(i).then(e=>e.json());return!n.id&&n["@id"]&&(n.id=n["@id"]),n.id!==e&&(n.id=e,n["@id"]&&(n["@id"]=e)),this.imageServices[i]=Object.assign(n,{real:!0}),this.imageServices[i]}async fetch(e,t){return fetch(e,t)}async loadService(e,t=!1){if(!this.config.disableThrottling){let e=!0;for(;e;)if(this.fetchingCount>=this.config.verificationsRequired)await new Promise(e=>setTimeout(e,500));else{e=!1;break}}let i=this.knownImageServers[g(c(e))];if(i&&!i.malformed&&!t){await i.result;let t=this.loadServiceSync(e);if(t)return t}this.fetchingCount++;let r=await this.fetchService(c(e),t);return this.fetchingCount--,r.real&&this.sample(r,e),r}loadServiceSync(e){let t=d(c(e));return this.imageServices[t]?this.imageServices[t]:this.config.approximateServices?this.predict(e):null}};!function(e={}){let t=e.events||(0,o.t)(),i=e.loader||new w;(0,a.t)((e,r)=>({loaded:{},loadServiceSync:(n,a,o)=>{let s=n.id||n["@id"],l=r().loaded[s];if(l&&"done"===l.status)return l.service;if(l&&"loading"===l.status)return null;if(l&&"error"===l.status)throw Error("Failed to load image service");let u={id:c(n),width:n.width||a?.width||0,height:n.height||a?.height||0,source:n},d=i.loadServiceSync(u);return d?(e(e=>({loaded:{...e.loaded,[s]:{status:"done",service:d,real:!0}}})),t.emit("image-service.loaded",{id:s,service:d})):o&&r().loadService(n,a).then(()=>{}),d},loadService:async(n,a)=>{let o=n.id||n["@id"],s=r().loaded[o];if(s&&"done"===s.status)return s.service;if(s&&"loading"===s.status)return new Promise((e,i)=>{let r=i=>{i.id===o&&(t.off("image-service.loaded",r),e(i.service||n))};t.on("image-service.loaded",r)});if(s&&"error"===s.status&&!a?.force)throw Error("Failed to load image service");t.emit("image-service.loading",{id:o});try{let r={id:c(n),width:n.width||0,height:n.height||0,source:n},s=await i.loadService(r,a?.force);return e(e=>({loaded:{...e.loaded,[o]:{status:"done",service:s,real:s.real}}})),t.emit("image-service.loaded",{id:o,service:s}),s}catch(e){throw t.emit("image-service.error",{id:o,error:e}),e}}}))}();let x=new w,C=new Map;function R(e,{vault:t=r.t,dereference:i=!1,...n}={}){let a=C.get(t);return a||(a=function(e=r.t,t={}){let i=t.imageServiceLoader||x;async function n(t,r,a=!1,o=[],s){let l=()=>i.getThumbnailFromResource(void 0,r,a,o);if(!t)return await i.getThumbnailFromResource(void 0,r,a,o);if("string"==typeof t){let e=S(t);return e&&o.push(e),await i.getThumbnailFromResource(void 0,r,a,o)}let c=e.get(t,{skipSelfReturn:!1});if("string"==typeof c)return{best:S(c),fallback:[],log:[]};if(!c)return await l();switch(await (async t=>{if(t&&t.thumbnail&&t.thumbnail.length){let r=e.get(t.thumbnail[0]),n=await i.getImageCandidates(r,a);n&&n.length&&o.push(...n)}})(c),c.type){case"Annotation":{let t=Array.isArray(c.body)?c.body:[c.body],n=e.get(t[0]);return s&&!n.width&&(n.width=s.width,n.height=s.height),await i.getThumbnailFromResource(n,r,a,o)}case"Canvas":return n(c.items[0],r,a,o,{width:c.width,height:c.height});case"AnnotationPage":return n(c.items[0],r,a,o,s);case"Choice":return!c.items||c.items[0]?await l():n(c.items[0],r,a,o,s);case"Collection":{let e=c.items[0];return e?n(e,r,a,o,s):await l()}case"Manifest":{let e=c.items[0];return e?n(e,r,a,o,s):await l()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return s&&!c.width&&(c.width=s.width,c.height=s.height),i.getThumbnailFromResource(c,r,a,o)}return await l()}return{getBestThumbnailAtSize:n}}(t),C.set(t,a)),a.getBestThumbnailAtSize(e,n,i)}},31458:(e,t,i)=>{function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,i){var n;return(n=function(e,t){if("object"!=r(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=r(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==r(n)?n:n+"")in e)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{t:()=>n})},48589:(e,t,i)=>{i.d(t,{Ay:()=>a,d5:()=>n.createPortal,qX:()=>n.flushSync});var r,n=i(98477);let a=r||(r=i.t(n,2))},60543:(e,t,i)=>{i.r(t),i.d(t,{Children:()=>n.Children,Component:()=>n.Component,Fragment:()=>n.Fragment,Profiler:()=>n.Profiler,PureComponent:()=>n.PureComponent,StrictMode:()=>n.StrictMode,Suspense:()=>n.Suspense,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:()=>n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,act:()=>n.act,cloneElement:()=>n.cloneElement,createContext:()=>n.createContext,createElement:()=>n.createElement,createFactory:()=>n.createFactory,createRef:()=>n.createRef,default:()=>o,forwardRef:()=>n.forwardRef,isValidElement:()=>n.isValidElement,lazy:()=>n.lazy,memo:()=>n.memo,startTransition:()=>n.startTransition,unstable_act:()=>n.unstable_act,useCallback:()=>n.useCallback,useContext:()=>n.useContext,useDebugValue:()=>n.useDebugValue,useDeferredValue:()=>n.useDeferredValue,useEffect:()=>n.useEffect,useId:()=>n.useId,useImperativeHandle:()=>n.useImperativeHandle,useInsertionEffect:()=>n.useInsertionEffect,useLayoutEffect:()=>n.useLayoutEffect,useMemo:()=>n.useMemo,useReducer:()=>n.useReducer,useRef:()=>n.useRef,useState:()=>n.useState,useSyncExternalStore:()=>n.useSyncExternalStore,useTransition:()=>n.useTransition,version:()=>n.version});var r,n=i(14232);let a={...r||(r=i.t(n,2))};a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED={ReactCurrentOwner:{current:null}};let o=a},64901:(e,t,i)=>{let r;i.r(t),i.d(t,{Helpers:()=>e9,Image:()=>eY,Primitives:()=>e0.default,Scroll:()=>e1.default,Slider:()=>e2.default,Viewer:()=>e3.default,default:()=>e7});var n,a,o=i(10887),s=i(14232);let l={...i.t(s,2)};l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED={ReactCurrentOwner:{current:null}};var c=i(71726),u=i(57906),d=i(3748),h=i(11806);let p=window.OpenSeadragon;if(!p&&!(p=o))throw Error("OpenSeadragon is missing.");let f="http://www.w3.org/2000/svg";p.Viewer&&(p.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo||(this._svgOverlayInfo=new g(this)),this._svgOverlayInfo});let g=function(e){let t=this;this._viewer=e,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(f,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(f,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){t.resize()}),this._viewer.addHandler("open",function(){t.resize()}),this._viewer.addHandler("rotate",function(){t.resize()}),this._viewer.addHandler("flip",function(){t.resize()}),this._viewer.addHandler("resize",function(){t.resize()}),this.resize()};g.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));let e=this._viewer.viewport.pixelFromPoint(new p.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0),i=this._viewer.viewport.getRotation(),r=this._viewer.viewport.getFlip(),n=this._viewer.viewport._containerInnerSize.x,a=n*t,o=a;r&&(a=-a,e.x=-e.x+n),this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+a+","+o+") rotate("+i+")")},onClick:function(e,t){new p.MouseTracker({element:e,clickHandler:t}).setTracking(!0)}};let m=e=>fetch(`${e.replace(/\/$/,"")}/info.json`).then(e=>e.json()).then(e=>e).catch(t=>{console.error(`The IIIF tilesource ${e.replace(/\/$/,"")}/info.json failed to load: ${t}`)});var y=(e=>(e.TiledImage="tiledImage",e.SimpleImage="simpleImage",e))(y||{});let v=e=>{let t=Array.isArray(null==e?void 0:e.service)&&(null==e?void 0:e.service.length)>0;return{uri:t?(e=>{let t,i;Array.isArray(e)&&(t=e[0])&&(i="@id"in t?t["@id"]:t.id);return i})(null==e?void 0:e.service):null==e?void 0:e.id,imageType:t?y.TiledImage:y.SimpleImage}},b=(0,s.createContext)(null),S={didCatch:!1,error:null};class w extends s.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=S}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){let{error:e}=this.state;if(null!==e){for(var t,i,r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];null==(t=(i=this.props).onReset)||t.call(i,{args:n,reason:"imperative-api"}),this.setState(S)}}componentDidCatch(e,t){var i,r;null==(i=(r=this.props).onError)||i.call(r,e,t)}componentDidUpdate(e,t){let{didCatch:i}=this.state,{resetKeys:r}=this.props;if(i&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,i)=>!Object.is(e,t[i]))}(e.resetKeys,r)){var n,a;null==(n=(a=this.props).onReset)||n.call(a,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(S)}}render(){let{children:e,fallbackRender:t,FallbackComponent:i,fallback:r}=this.props,{didCatch:n,error:a}=this.state,o=e;if(n){let e={error:a,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)o=t(e);else if(i)o=(0,s.createElement)(i,e);else if(void 0!==r)o=r;else throw a}return(0,s.createElement)(b.Provider,{value:{didCatch:n,error:a,resetErrorBoundary:this.resetErrorBoundary}},o)}}var x="colors",C="sizes",R="space",A={gap:R,gridGap:R,columnGap:R,gridColumnGap:R,rowGap:R,gridRowGap:R,inset:R,insetBlock:R,insetBlockEnd:R,insetBlockStart:R,insetInline:R,insetInlineEnd:R,insetInlineStart:R,margin:R,marginTop:R,marginRight:R,marginBottom:R,marginLeft:R,marginBlock:R,marginBlockEnd:R,marginBlockStart:R,marginInline:R,marginInlineEnd:R,marginInlineStart:R,padding:R,paddingTop:R,paddingRight:R,paddingBottom:R,paddingLeft:R,paddingBlock:R,paddingBlockEnd:R,paddingBlockStart:R,paddingInline:R,paddingInlineEnd:R,paddingInlineStart:R,top:R,right:R,bottom:R,left:R,scrollMargin:R,scrollMarginTop:R,scrollMarginRight:R,scrollMarginBottom:R,scrollMarginLeft:R,scrollMarginX:R,scrollMarginY:R,scrollMarginBlock:R,scrollMarginBlockEnd:R,scrollMarginBlockStart:R,scrollMarginInline:R,scrollMarginInlineEnd:R,scrollMarginInlineStart:R,scrollPadding:R,scrollPaddingTop:R,scrollPaddingRight:R,scrollPaddingBottom:R,scrollPaddingLeft:R,scrollPaddingX:R,scrollPaddingY:R,scrollPaddingBlock:R,scrollPaddingBlockEnd:R,scrollPaddingBlockStart:R,scrollPaddingInline:R,scrollPaddingInlineEnd:R,scrollPaddingInlineStart:R,fontSize:"fontSizes",background:x,backgroundColor:x,backgroundImage:x,borderImage:x,border:x,borderBlock:x,borderBlockEnd:x,borderBlockStart:x,borderBottom:x,borderBottomColor:x,borderColor:x,borderInline:x,borderInlineEnd:x,borderInlineStart:x,borderLeft:x,borderLeftColor:x,borderRight:x,borderRightColor:x,borderTop:x,borderTopColor:x,caretColor:x,color:x,columnRuleColor:x,fill:x,outline:x,outlineColor:x,stroke:x,textDecorationColor:x,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:C,minBlockSize:C,maxBlockSize:C,inlineSize:C,minInlineSize:C,maxInlineSize:C,width:C,minWidth:C,maxWidth:C,height:C,minHeight:C,maxHeight:C,flexBasis:C,gridTemplateColumns:C,gridTemplateRows:C,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},E=(e,t)=>"function"==typeof t?{"()":Function.prototype.toString.call(t)}:t,k=()=>{let e=Object.create(null);return(t,i,...r)=>{let n=JSON.stringify(t,E);return n in e?e[n]:e[n]=i(t,...r)}},I=Symbol.for("sxs.internal"),O=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),_=e=>{for(let t in e)return!0;return!1},{hasOwnProperty:T}=Object.prototype,P=e=>e.includes("-")?e:e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),M=/\s+(?![^()]*\))/,$=e=>t=>e(..."string"==typeof t?String(t).split(M):[t]),j={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:$((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e})),marginInline:$((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e})),maxSize:$((e,t)=>({maxBlockSize:e,maxInlineSize:t||e})),minSize:$((e,t)=>({minBlockSize:e,minInlineSize:t||e})),paddingBlock:$((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e})),paddingInline:$((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e}))},L=/([\d.]+)([^]*)/,F=(e,t)=>e.length?e.reduce((e,i)=>(e.push(...t.map(e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(e)?`:is(${i})`:i):i+" "+e)),e),[]):t,B=(e,t)=>e in z&&"string"==typeof t?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(t,i,r,n)=>i+("stretch"===r?`-moz-available${n};${P(e)}:${i}-webkit-fill-available`:`-moz-fit-content${n};${P(e)}:${i}fit-content`)+n):String(t),z={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},D=e=>e?e+"-":"",N=(e,t,i)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(e,r,n,a,o)=>"$"==a==!!n?e:(r||"--"==a?"calc(":"")+"var(--"+("$"===a?D(t)+(o.includes("$")?"":D(i))+o.replace(/\$/g,"-"):o)+")"+(r||"--"==a?"*"+(r||"")+(n||"1")+")":"")),W=/\s*,\s*(?![^()]*\))/,H=Object.prototype.toString,U=(e,t,i,r,n)=>{let a,o,s,l=(e,t,i)=>{let c,u,d=e=>{var h;for(c in e){let p=64===c.charCodeAt(0);for(u of p&&Array.isArray(e[c])?e[c]:[e[c]]){let e=/[A-Z]/.test(h=c)?h:h.replace(/-[^]/g,e=>e[1].toUpperCase()),f="object"==typeof u&&u&&u.toString===H&&(!r.utils[e]||!t.length);if(e in r.utils&&!f){let t=r.utils[e];if(t!==o){o=t,d(t(u)),o=null;continue}}else if(e in j){let t=j[e];if(t!==s){s=t,d(t(u)),s=null;continue}}if(p&&(c=(c.slice(1)in r.media?"@media "+r.media[c.slice(1)]:c).replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(e,t,i,r,n,a)=>{let o=L.test(t),s=.0625*(o?-1:1),[l,c]=o?[r,t]:[t,r];return"("+("="===i[0]?"":">"===i[0]===o?"max-":"min-")+l+":"+("="!==i[0]&&1===i.length?c.replace(L,(e,t,r)=>Number(t)+s*(">"===i?1:-1)+r):c)+(n?") and ("+(">"===n[0]?"min-":"max-")+l+":"+(1===n.length?a.replace(L,(e,t,i)=>Number(t)+s*(">"===n?-1:1)+i):a):"")+")"})),f){let e=p?i.concat(c):[...i],r=p?[...t]:F(t,c.split(W));void 0!==a&&n(V(...a)),a=void 0,l(u,r,e)}else void 0===a&&(a=[[],t,i]),c=p||36!==c.charCodeAt(0)?c:`--${D(r.prefix)}${c.slice(1).replace(/\$/g,"-")}`,u=f?u:"number"==typeof u?u&&e in q?String(u)+"px":String(u):N(B(e,u??""),r.prefix,r.themeMap[e]),a[0].push(`${p?`${c} `:`${P(c)}:`}${u}`)}}};d(e),void 0!==a&&n(V(...a)),a=void 0};l(e,t,i)},V=(e,t,i)=>`${i.map(e=>`${e}{`).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,q={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},J=e=>String.fromCharCode(e+(e>25?39:97)),Z=e=>(e=>{let t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=J(t%52)+i;return J(t%52)+i})(((e,t)=>{let i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e})(5381,JSON.stringify(e))>>>0),Q=["themed","global","styled","onevar","resonevar","allvar","inline"],K=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch{return!1}},G=e=>{let t=e.group,i=t.cssRules.length;e.apply=e=>{try{t.insertRule(e,i),++i}catch{}}},X=Symbol(),Y=k(),ee=(e,t)=>Y(e,()=>(...i)=>{let r={type:null,composers:new Set};for(let t of i)if(null!=t)if(t[I])for(let e of(null==r.type&&(r.type=t[I].type),t[I].composers))r.composers.add(e);else t.constructor!==Object||t.$$typeof?null==r.type&&(r.type=t):r.composers.add(et(t,e));return null==r.type&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),ei(e,r,t)}),et=({variants:e,compoundVariants:t,defaultVariants:i,...r},n)=>{let a=`${D(n.prefix)}c-${Z(r)}`,o=[],s=[],l=Object.create(null),c=[];for(let e in i)l[e]=String(i[e]);if("object"==typeof e&&e)for(let t in e){T.call(l,t)||(l[t]="undefined");let i=e[t];for(let e in i){let r={[t]:String(e)};"undefined"===String(e)&&c.push(t);let n=i[e],a=[r,n,!_(n)];o.push(a)}}if("object"==typeof t&&t)for(let e of t){let{css:t,...i}=e;for(let e in t="object"==typeof t&&t||{},i)i[e]=String(i[e]);let r=[i,t,!_(t)];s.push(r)}return[a,r,o,s,l,c]},ei=(e,t,i)=>{let[r,n,a,o]=er(t.composers),s="function"==typeof t.type||t.type.$$typeof?(e=>{function t(){for(let i=0;i<t[X].length;i++){let[r,n]=t[X][i];e.rules[r].apply(n)}return t[X]=[],null}return t[X]=[],t.rules={},Q.forEach(e=>t.rules[e]={apply:i=>t[X].push([e,i])}),t})(i):null,l=(s||i).rules,c=`.${r}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,u=u=>{let{css:d,...h}=u="object"==typeof u&&u||ea,p={};for(let e in a)if(delete h[e],e in u){let t=u[e];"object"==typeof t&&t?p[e]={"@initial":a[e],...t}:(t=String(t),p[e]="undefined"!==t||o.has(e)?t:a[e])}else p[e]=a[e];let f=new Set([...n]);for(let[r,n,a,o]of t.composers){i.rules.styled.cache.has(r)||(i.rules.styled.cache.add(r),U(n,[`.${r}`],[],e,e=>{l.styled.apply(e)}));let t=en(a,p,e.media),s=en(o,p,e.media,!0);for(let n of t)if(void 0!==n)for(let[t,a,o]of n){let n=`${r}-${Z(a)}-${t}`;f.add(n);let s=(o?i.rules.resonevar:i.rules.onevar).cache,c=o?l.resonevar:l.onevar;s.has(n)||(s.add(n),U(a,[`.${n}`],[],e,e=>{c.apply(e)}))}for(let t of s)if(void 0!==t)for(let[n,a]of t){let t=`${r}-${Z(a)}-${n}`;f.add(t),i.rules.allvar.cache.has(t)||(i.rules.allvar.cache.add(t),U(a,[`.${t}`],[],e,e=>{l.allvar.apply(e)}))}}if("object"==typeof d&&d){let t=`${r}-i${Z(d)}-css`;f.add(t),i.rules.inline.cache.has(t)||(i.rules.inline.cache.add(t),U(d,[`.${t}`],[],e,e=>{l.inline.apply(e)}))}for(let e of String(u.className||"").trim().split(/\s+/))e&&f.add(e);let g=h.className=[...f].join(" ");return{type:t.type,className:g,selector:c,props:h,toString:()=>g,deferredInjector:s}};return O(u,{className:r,selector:c,[I]:t,toString:()=>(i.rules.styled.cache.has(r)||u(),r)})},er=e=>{let t="",i=[],r={},n=[];for(let[a,,,,o,s]of e)for(let e in""===t&&(t=a),i.push(a),n.push(...s),o){let t=o[e];(void 0===r[e]||"undefined"!==t||s.includes(t))&&(r[e]=t)}return[t,i,r,new Set(n)]},en=(e,t,i,r)=>{let n=[];e:for(let[a,o,s]of e){if(s)continue;let e,l=0,c=!1;for(e in a){let r=a[e],n=t[e];if(n!==r){if("object"!=typeof n||!n)continue e;{let e,t,a=0;for(let o in n){if(r===String(n[o])){if("@initial"!==o){let e=o.slice(1);(t=t||[]).push(e in i?i[e]:o.replace(/^@media ?/,"")),c=!0}l+=a,e=!0}++a}if(t&&t.length&&(o={["@media "+t.join(", ")]:o}),!e)continue e}}}(n[l]=n[l]||[]).push([r?"cv":`${e}-${a[e]}`,o,c])}return n},ea={},eo=k(),es=k(),el=class{constructor(e,t,i,r){this.token=null==e?"":String(e),this.value=null==t?"":String(t),this.scale=null==i?"":String(i),this.prefix=null==r?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+D(this.prefix)+D(this.scale)+this.token}toString(){return this.computedValue}},ec=k(),eu=k(),ed=k();let{styled:eh,css:ep,keyframes:ef,createTheme:eg}=(e=>{let t=(e=>{let t=!1,i=eu(e,e=>{t=!0;let i="prefix"in(e="object"==typeof e&&e||{})?String(e.prefix):"",r="object"==typeof e.media&&e.media||{},n="object"==typeof e.root?e.root||null:globalThis.document||null,a="object"==typeof e.theme&&e.theme||{},o={prefix:i,media:r,theme:a,themeMap:"object"==typeof e.themeMap&&e.themeMap||{...A},utils:"object"==typeof e.utils&&e.utils||{}},s=(e=>{let t,i=()=>{let{cssRules:e}=t.sheet;return[].map.call(e,(i,r)=>{let{cssText:n}=i,a="";if(n.startsWith("--sxs"))return"";if(e[r-1]&&(a=e[r-1].cssText).startsWith("--sxs")){if(!i.cssRules.length)return"";for(let e in t.rules)if(t.rules[e].group===i)return`--sxs{--sxs:${[...t.rules[e].cache].join(" ")}}${n}`;return i.cssRules.length?`${a}${n}`:""}return n}).join("")},r=()=>{if(t){let{rules:e,sheet:i}=t;if(!i.deleteRule){for(;3===Object(Object(i.cssRules)[0]).type;)i.cssRules.splice(0,1);i.cssRules=[]}for(let t in e)delete e[t]}for(let n of Object(e).styleSheets||[])if(K(n)){for(let e=0,a=n.cssRules;a[e];++e){let o=Object(a[e]);if(1!==o.type)continue;let s=Object(a[e+1]);if(4!==s.type)continue;++e;let{cssText:l}=o;if(!l.startsWith("--sxs"))continue;let c=l.slice(14,-3).trim().split(/\s+/),u=Q[c[0]];u&&(t||(t={sheet:n,reset:r,rules:{},toString:i}),t.rules[u]={group:s,index:e,cache:new Set(c)})}if(t)break}if(!t){let n=(e,t)=>({type:t,cssRules:[],insertRule(e,t){this.cssRules.splice(t,0,n(e,{import:3,undefined:1}[(e.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return"@media{}"===e?`@media{${[].map.call(this.cssRules,e=>e.cssText).join("")}}`:e}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:n("","text/css"),rules:{},reset:r,toString:i}}let{sheet:n,rules:a}=t;for(let e=Q.length-1;e>=0;--e){let t=Q[e];if(!a[t]){let i=Q[e+1],r=a[i]?a[i].index:n.cssRules.length;n.insertRule("@media{}",r),n.insertRule(`--sxs{--sxs:${e}}`,r),a[t]={group:n.cssRules[r+1],index:r,cache:new Set([e])}}G(a[t])}};return r(),t})(n),l={css:ee(o,s),globalCss:((e,t)=>eo(e,()=>(...i)=>{let r=()=>{for(let r of i){let i=Z(r="object"==typeof r&&r||{});if(!t.rules.global.cache.has(i)){if(t.rules.global.cache.add(i),"@import"in r){let e=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let i of[].concat(r["@import"]))i=i.includes('"')||i.includes("'")?i:`"${i}"`,t.sheet.insertRule(`@import ${i};`,e++);delete r["@import"]}U(r,[],[],e,e=>{t.rules.global.apply(e)})}}return""};return O(r,{toString:r})}))(o,s),keyframes:((e,t)=>es(e,()=>i=>{let r=`${D(e.prefix)}k-${Z(i)}`,n=()=>{if(!t.rules.global.cache.has(r)){t.rules.global.cache.add(r);let n=[];U(i,[],[],e,e=>n.push(e));let a=`@keyframes ${r}{${n.join("")}}`;t.rules.global.apply(a)}return r};return O(n,{get name(){return n()},toString:n})}))(o,s),createTheme:((e,t)=>ec(e,()=>(i,r)=>{r="object"==typeof i&&i||Object(r);let n=`.${i=(i="string"==typeof i?i:"")||`${D(e.prefix)}t-${Z(r)}`}`,a={},o=[];for(let t in r)for(let i in a[t]={},r[t]){let n=`--${D(e.prefix)}${t}-${i}`,s=N(String(r[t][i]),e.prefix,t);a[t][i]=new el(i,s,t,e.prefix),o.push(`${n}:${s}`)}let s=()=>{if(o.length&&!t.rules.themed.cache.has(i)){t.rules.themed.cache.add(i);let n=`${r===e.theme?":root,":""}.${i}{${o.join(";")}}`;t.rules.themed.apply(n)}return i};return{...a,get className(){return s()},selector:n,toString:s}}))(o,s),reset(){s.reset(),l.theme.toString()},theme:{},sheet:s,config:o,prefix:i,getCssText:s.toString,toString:s.toString};return String(l.theme=l.createTheme(a)),l});return t||i.reset(),i})(e);return t.styled=(({config:e,sheet:t})=>ed(e,()=>{let i=ee(e,t);return(...e)=>{let t=i(...e),r=t[I].type,n=l.forwardRef((e,i)=>{let n=e&&e.as||r,{props:a,deferredInjector:o}=t(e);return delete a.as,a.ref=i,o?l.createElement(l.Fragment,null,l.createElement(n,a),l.createElement(o,null)):l.createElement(n,a)});return n.className=t.className,n.displayName=`Styled.${r.displayName||r.name||r}`,n.selector=t.selector,n.toString=()=>t.selector,n[I]=t[I],n}}))(t),t})({theme:{colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:"hsl(209 100% 38.2%)",accentMuted:"hsl(209 80% 61.8%)",accentAlt:"hsl(209 80% 30%)",secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 200ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},media:{xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"}}),em=eh("div",{display:"flex",flexDirection:"column",alignItems:"center"}),ey=eh("p",{fontWeight:"bold",fontSize:"x-large"}),ev=eh("span",{fontSize:"medium"}),eb=({error:e})=>{let{message:t}=e;return l.createElement(em,{role:"alert"},l.createElement(ey,{"data-testid":"headline"},"Something went wrong"),t&&l.createElement(ev,null,`Error message: ${t}`," "))},eS=eh("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),ew=eh("div",{position:"relative",width:"100%",height:"100%",zIndex:"0",".clover-iiif-image-openseadragon-annotation":{position:"relative",backgroundColor:"transparent",border:"2px solid #0003",boxSizing:"content-box",borderRadius:"3px",boxShadow:"0 0 38vw 38vw transparent",transition:"box-shadow 100ms ease-in-out",zIndex:"0",label:{opacity:0,position:"absolute",lineHeight:"1.47rem",pointerEvents:"none",textAlign:"center",minWidth:"300px",maxWidth:"20vw",padding:"0.5rem",borderRadius:"3px",top:"calc(100% + 0.5rem)",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"$primary",color:"$secondary",transition:"opacity 100ms ease-in-out"},"&[data-active=true]":{border:"2px solid $accent !important",boxShadow:"0 0 38vw 38vw #0003",zIndex:"99999999",label:{opacity:1}}}}),ex=eh("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${eS}`]:{display:"block"}},false:{[`${eS}`]:{display:"none"}}}}}),eC=new Uint8Array(16),eR=[];for(let e=0;e<256;++e)eR.push((e+256).toString(16).slice(1));let eA={randomUUID:"u">typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function eE(e,t,i){if(eA.randomUUID&&!e)return eA.randomUUID();let n=(e=e||{}).random||(e.rng||function(){if(!r&&!(r="u">typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(eC)})();return n[6]=15&n[6]|64,n[8]=63&n[8]|128,function(e,t=0){return eR[e[t+0]]+eR[e[t+1]]+eR[e[t+2]]+eR[e[t+3]]+"-"+eR[e[t+4]]+eR[e[t+5]]+"-"+eR[e[t+6]]+eR[e[t+7]]+"-"+eR[e[t+8]]+eR[e[t+9]]+"-"+eR[e[t+10]]+eR[e[t+11]]+eR[e[t+12]]+eR[e[t+13]]+eR[e[t+14]]+eR[e[t+15]]}(n)}let ek={behavior:"smooth",block:"center"},eI={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},annotations:{motivations:void 0},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},crossOrigin:"anonymous",ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:ek}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1},eO=function(e){var t,i;let r=(null==(i=null==(t=null==eI?void 0:eI.informationPanel)?void 0:t.vtt)?void 0:i.autoScroll)||{enabled:!0,settings:ek};if(null==e)return{enabled:r.enabled,settings:{...r.settings}};if("boolean"==typeof e)return{enabled:e,settings:{...r.settings}};if("enabled"in e)return{enabled:e.enabled,settings:{...e.settings}};let n={enabled:!0,settings:{...e}};return function({behavior:e,block:t}){let i=["auto","instant","smooth"],r=["center","end","nearest","start"];if(!i.includes(e))throw TypeError(`'${e}' not in ${i.join(" | ")}`);if(!r.includes(t))throw TypeError(`'${t}' not in ${r.join(" | ")}`)}(n.settings),n}(null==(a=null==(n=null==eI?void 0:eI.informationPanel)?void 0:n.vtt)?void 0:a.autoScroll),e_=(()=>{var e;return{activeCanvas:"",activeManifest:"",activePlayer:null,activeSelector:void 0,OSDImageLoaded:!1,collection:{},configOptions:((e=eI)=>(function e(t){return Array.isArray(t)?t.map(t=>e(t)):t&&"object"==typeof t?Object.entries(t).reduce((t,[i,r])=>(t[i]=e(r),t),{}):t})(e))(),customDisplays:[],plugins:[],isAutoScrollEnabled:eO.enabled,isAutoScrolling:!1,isInformationOpen:(null==(e=null==eI?void 0:eI.informationPanel)?void 0:e.open)??!0,isLoaded:!1,isPaged:!1,isUserScrolling:void 0,sequence:[[],[]],vault:new c.n,viewingDirection:"left-to-right",openSeadragonViewer:null,viewerId:eE(),visibleCanvases:[],visibleAnnotations:[]}})(),eT=l.createContext(e_),eP=l.createContext(e_);function eM(){let e=l.useContext(eT);if(void 0===e)throw Error("useViewerState must be used within a ViewerProvider");return e}function e$(){let e=l.useContext(eP);if(void 0===e)throw Error("useViewerDispatch must be used within a ViewerProvider");return e}let ej=eh("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),eL=({className:e,id:t,label:i,children:r})=>{let n=t.split("-")[0].replace(/([A-Z])/g,"-$1").toLowerCase().replace(/^-/,"");return l.createElement(ej,{id:t,className:e,"data-testid":"openseadragon-button","data-button":n},l.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${t}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},l.createElement("title",{id:`${t}-svg-title`},i),r))},eF=eh("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),eB={commonClose:"Close",commonNext:"Next",commonOpen:"Open",commonPrevious:"Previous",commonSearch:"Search",commonSearchPlaceholder:"Search...",commonShare:"Share",commonViewAll:"View All",copyFailure:"Failed",copySuccess:"Copied",contentSearchLoading:"Loading...",contentSearchPlaceholder:"Search",contentSearchResultsNone:"No Results",contentSearchResultsMore:"More Results",imageFullScreen:"Full screen",imageResetZoom:"Reset zoom",imageRotateLeft:"Rotate left",imageRotateRight:"Rotate right",imageZoomIn:"Zoom in",imageZoomOut:"Zoom out",informationPanelTabs:"Select",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"About",informationPanelTabsAnnotations:"Annotations",informationPanelTabsSearch:"Search",informationPanelToggle:"More Information",shareCollectionJson:"View Collection",shareCollectionCopy:"Copy Collection URL",shareManifestJson:"View Manifest",shareManifestCopy:"Copy Manifest URL"},ez="clover",eD=Object.fromEntries(Object.entries({en:eB,fi:{commonClose:"Sulje",commonNext:"Seuraava",commonPrevious:"Edellinen",commonSearch:"Hae",commonSearchPlaceholder:"Hae...",commonShare:"Jaa",commonViewAll:"N\xe4yt\xe4 kaikki",copyFailure:"Kopiointi ep\xe4onnistui",copySuccess:"Kopioitu",contentSearchLoading:"Ladataan...",contentSearchPlaceholder:"Haku",contentSearchResultsNone:"Ei osumia",contentSearchResultsMore:"Lis\xe4\xe4 osumia",informationPanelTabs:"Valitse",informationPanelTabsClose:"Katselu",informationPanelTabsAbout:"Tiedot",informationPanelTabsAnnotations:"Annotaatiot",informationPanelTabsSearch:"Haku",informationPanelToggle:"Lis\xe4tiedot",shareCollectionJson:"N\xe4yt\xe4 kokoelma",shareCollectionCopy:"Kopioi kokoelman osoite",shareManifestJson:"N\xe4yt\xe4 manifesti",shareManifestCopy:"Kopioi manifestin osoite"},fr:{commonClose:"Fermer",commonNext:"Suivant",commonOpen:"Ouvrir",commonPrevious:"Pr\xe9c\xe9dent",commonSearch:"Rechercher",commonSearchPlaceholder:"Rechercher",commonShare:"Partager",commonViewAll:"Tout afficher",copyFailure:"\xc9chec",copySuccess:"Copi\xe9",contentSearchLoading:"Chargement",contentSearchPlaceholder:"Rechercher",contentSearchResultsNone:"Aucun r\xe9sultat",contentSearchResultsMore:"Plus de r\xe9sultats",imageFullScreen:"Plein \xe9cran",imageResetZoom:"R\xe9initialiser le zoom",imageRotateLeft:"Rotation \xe0 gauche",imageRotateRight:"Rotation \xe0 droite",imageZoomIn:"Zoom avant",imageZoomOut:"Zoom arri\xe8re",informationPanelTabs:"S\xe9lectionner",informationPanelTabsClose:"Visionneuse",informationPanelTabsAbout:"\xc0 propos",informationPanelTabsAnnotations:"Annotations",informationPanelTabsSearch:"Recherche",informationPanelToggle:"Plus dinformations",shareCollectionJson:"Afficher la collection",shareCollectionCopy:"Copier lURL de la collection",shareManifestJson:"Afficher le manifeste",shareManifestCopy:"Copier lURL du manifeste"},nb:{commonClose:"Lukk",commonNext:"Neste",commonPrevious:"Forrige",commonSearch:"S\xf8k",commonSearchPlaceholder:"S\xf8k...",commonShare:"Del",commonViewAll:"Se alle",copyFailure:"Feilet",copySuccess:"Kopiert",contentSearchLoading:"Laster inn...",contentSearchPlaceholder:"S\xf8k",contentSearchResultsNone:"Ingen resultat",contentSearchResultsMore:"Flere resultat",informationPanelTabs:"Velg",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"Om",informationPanelTabsAnnotations:"Annoteringer",informationPanelTabsSearch:"S\xf8k",informationPanelToggle:"Mer informasjon",shareCollectionJson:"Se samlingen",shareCollectionCopy:"Kopi\xe9r samlingens URL",shareManifestJson:"Se manifestet",shareManifestCopy:"Kopi\xe9r manifestets URL"},nn:{commonClose:"Lukk",commonNext:"Neste",commonPrevious:"F\xf8rre",commonSearch:"S\xf8k",commonSearchPlaceholder:"S\xf8k...",commonShare:"Del",commonViewAll:"Sj\xe5 alle",copyFailure:"Feila",copySuccess:"Kopiert",contentSearchLoading:"Laster inn...",contentSearchPlaceholder:"S\xf8k",contentSearchResultsNone:"Ingen resultat",contentSearchResultsMore:"Fleire resultat",informationPanelTabs:"Vel",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"Om",informationPanelTabsAnnotations:"Annoteringa",informationPanelTabsSearch:"S\xf8k",informationPanelToggle:"Meir informasjon",shareCollectionJson:"Sj\xe5 samlinga",shareCollectionCopy:"Kopi\xe9r samlingas URL",shareManifestJson:"Sj\xe5 manifestet",shareManifestCopy:"Kopi\xe9r manifestets URL"},no:{commonClose:"Lukk",commonNext:"Neste",commonPrevious:"Forrige",commonSearch:"S\xf8k",commonSearchPlaceholder:"S\xf8k...",commonShare:"Del",commonViewAll:"Se alle",copyFailure:"Feilet",copySuccess:"Kopiert",contentSearchLoading:"Laster inn...",contentSearchPlaceholder:"S\xf8k",contentSearchResultsNone:"Ingen resultat",contentSearchResultsMore:"Flere resultat",informationPanelTabs:"Velg",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"Om",informationPanelTabsAnnotations:"Annoteringer",informationPanelTabsSearch:"S\xf8k",informationPanelToggle:"Mer informasjon",shareCollectionJson:"Se samlingen",shareCollectionCopy:"Kopi\xe9r samlingens URL",shareManifestJson:"Se manifestet",shareManifestCopy:"Kopi\xe9r manifestets URL"},pt:{}}).map(([e,t])=>[e,{[ez]:t}])),eN={defaultNS:ez,fallbackLng:"en",ns:[ez],resources:{...eD}},eW=!1;!function(e={}){if(eW)(function(e){if(e){for(let[t,i]of Object.entries(e))if(i)for(let[e,r]of Object.entries(i))r&&h.Ay.addResourceBundle(t,e,r,!0,!0)}})(e.resources),e.lng&&h.Ay.changeLanguage(e.lng),e.fallbackLng&&(h.Ay.options.fallbackLng=e.fallbackLng);else{let t,i,r=(t=eN.resources,i=e.resources,{...t||{},...i||{}});h.Ay.use(d.A).use(u.r9).init({...eN,...e,resources:r,ns:e.ns??eN.ns,defaultNS:e.defaultNS??eN.defaultNS,fallbackLng:e.fallbackLng??eN.fallbackLng}),eW=!0}h.Ay}();let eH=()=>l.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),eU=()=>l.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),eV=()=>l.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),eq=()=>l.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),eJ=()=>l.createElement(l.Fragment,null,l.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),l.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),eZ=({_cloverViewerHasPlaceholder:e,config:t})=>{let{t:i}=function(e=ez){let t=(0,u.Bd)(e),{t:i}=t,r=(0,s.useCallback)((e,t)=>{let r=i(e,t);return"string"!=typeof r||r===e?eB[e]??e:r},[i]);return{...t,t:r}}(),{activeCanvas:r,plugins:n,vault:a,openSeadragonViewer:o}=eM(),c=a.get({id:r,type:"Canvas"});return(0,s.useEffect)(()=>{if(!o)return;let e=o.viewport.getRotation();o.addHandler("home",()=>{o.viewport.setRotation(e)})},[o]),l.createElement(eF,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:e},t.showZoomControl&&l.createElement(l.Fragment,null,l.createElement(eL,{id:t.zoomInButton,label:i("imageZoomIn")},l.createElement(eH,null)),l.createElement(eL,{id:t.zoomOutButton,label:i("imageZoomOut")},l.createElement(eU,null))),t.showFullPageControl&&l.createElement(eL,{id:t.fullPageButton,label:i("imageFullScreen")},l.createElement(eV,null)),t.showRotationControl&&l.createElement(l.Fragment,null,l.createElement(eL,{id:t.rotateRightButton,label:i("imageRotateRight")},l.createElement(eJ,null)),l.createElement(eL,{id:t.rotateLeftButton,label:i("imageRotateLeft")},l.createElement(eJ,null))),t.showHomeControl&&l.createElement(eL,{id:t.homeButton,label:i("imageResetZoom")},l.createElement(eq,null)),n.filter(e=>{var t;return null==(t=e.imageViewer)?void 0:t.controls}).map((e,t)=>{var i,r,n,a;let o=null==(r=null==(i=e.imageViewer)?void 0:i.controls)?void 0:r.component;return l.createElement(o,{key:t,...null==(a=null==(n=null==e?void 0:e.imageViewer)?void 0:n.controls)?void 0:a.componentProps,canvas:c,useViewerDispatch:e$,useViewerState:eM})}))};async function eQ(e,t=3,i=500){try{return await e()}catch(r){if(t<=0)throw r;return await new Promise(e=>setTimeout(e,i)),eQ(e,t-1,i)}}let eK=e=>new Promise(t=>setTimeout(t,e)),eG=async(e,t,i=3,r=300)=>{for(let n=0;n<i;n++){let i=t?t-1:0,n=e.getItemAt(i);if(n)return n;await eK(r)}throw Error("No base item found at index 0 after retries")},eX=({annotations:e,ariaLabel:t,config:i,uri:r,_cloverViewerHasPlaceholder:n,imageType:a,openSeadragonCallback:c})=>{let[u,d]=(0,s.useState)([]),[h,p]=(0,s.useState)([]),[f,g]=(0,s.useState)(),[y,v]=(0,s.useState)([]),b=e$(),S=(0,s.useRef)(!1),w=!1===i.gestureSettingsMouse.scrollToZoom;function x(){f&&(null==c||c(f))}return(0,s.useEffect)(()=>(S.current||(S.current=!0,f||g(o(i))),()=>null==f?void 0:f.destroy()),[]),(0,s.useEffect)(()=>{x()},[f,c]),(0,s.useEffect)(()=>{f&&JSON.stringify(r)!==JSON.stringify(h)&&(f.forceRedraw(),w&&f.addHandler("canvas-scroll",function(e){e.preventDefault=!1}),p(r))},[w,f,h,r]),(0,s.useEffect)(()=>{h.length&&f&&(f.close(),(async()=>{switch(a){case"simpleImage":let t=1,i=0;for(let r=0;r<h.length;r++){let n=h[r];if(e){let e=new Image;e.src=n,await e.decode(),v(t=>[...t,{width:null==e?void 0:e.width,height:null==e?void 0:e.height}])}try{if(0!==r){let e=(await eG(f.world,r)).getBounds();i=e.x+e.width,t=e.height}f.addSimpleImage({url:n,x:i,y:0,height:t,success:()=>{d(e=>[...e,n]),"function"==typeof b&&b({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(e){console.error(`Failed to load image at ${n}:`,e)}}break;case"tiledImage":{let e=1,t=0;for(let i=0;i<h.length;i++){let r=h[i];try{let n=await eQ(()=>m(r),3,1e3);if(!n)throw Error(`No tile source for ${r}`);if(0!==i){let r=(await eG(f.world,i)).getBounds();t=r.x+r.width,e=r.height}f.addTiledImage({tileSource:n,x:t,y:0,height:e,success:()=>{d(e=>[...e,r]),"function"==typeof b&&b({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(e){console.error(`Failed to load tile at ${r}:`,e)}}break}default:console.warn(`Unsupported imageType: "${a}"`)}})().catch(e=>console.error("Error drawing tiles",e)))},[h,a,f]),(0,s.useEffect)(()=>{if(u){let e=0,t=()=>{if(e<3){let i=null==f?void 0:f.world.getHomeBounds();i&&(null==f||f.viewport.fitBounds(i,!0)),e++,setTimeout(t,50)}};t(),null==f||f.addHandler("canvas-click",e=>{let t=null==f?void 0:f.getOverlayById(e.originalTarget.id);if(t){let i=null==t?void 0:t.getBounds(f.viewport);return i.x-=.1,i.y-=.1,i.width+=.2,i.height+=.2,null==f||f.viewport.fitBounds(i,!1),e.preventDefaultAction=!0}})}},[u]),(0,s.useEffect)(()=>{e&&(null==f||f.clearOverlays(),e.forEach(e=>{var t,i,r,n;let{annotation:a,targetIndex:s}=e,l=(null==(i=null==(t=null==f?void 0:f.viewport)?void 0:t.getBounds())?void 0:i.width)||1,c=null==f?void 0:f.world.getItemAt(s),u=c?(null==c?void 0:c.getBounds().width)/(null==c?void 0:c.getContentSize().x):(null==(r=y[s])?void 0:r.width)/l,d=(e=>{var t,i,r,n,a;let o={id:"string"==typeof e?e:e.source};if("string"==typeof e){if(e.includes("#xywh=")){let t=e.split("#xywh=");if(t&&t[1]){let[e,i,r,n]=t[1].split(",").map(e=>Number(e));o={id:t[0],rect:{x:e,y:i,w:r,h:n}}}}else if(e.includes("#t=")){let t=e.split("#t=");t&&t[1]&&(o={id:t[0],t:t[1]})}}else if("object"==typeof e){if((null==(t=e.selector)?void 0:t.type)==="PointSelector")o={id:e.source,point:{x:e.selector.x,y:e.selector.y}};else if((null==(i=e.selector)?void 0:i.type)==="SvgSelector")o={id:e.source,svg:e.selector.value};else if((null==(r=e.selector)?void 0:r.type)==="FragmentSelector"&&null!=(n=e.selector)&&n.value.includes("xywh=")&&"Canvas"==e.source.type&&e.source.id){let t=null==(a=e.selector)?void 0:a.value.split("xywh=");if(t&&t[1]){let[i,r,n,a]=t[1].split(",").map(e=>Number(e));o={id:e.source.id,rect:{x:i,y:r,w:n,h:a}}}}}return o})(null==a?void 0:a.target),h=null!=a&&a.body?null==(n=null==a?void 0:a.body[0])?void 0:n.value:void 0;if(null!=d&&d.rect){let{x:e,y:t,w:i,h:r}=null==d?void 0:d.rect,n=function(e,t,i){let r=e*i;if(0===t)return r;for(;t>0;){let e=null==f?void 0:f.world.getItemAt(t-1);if(e)r+=e.getBounds().width,t--;else break}return r}(e,s,u),l=new o.Rect(n,t*u,i*u,r*u),c=document.createElement("button");if(c.classList.add("clover-iiif-image-openseadragon-annotation"),c.id=a.id,c.setAttribute("tabindex","0"),c.setAttribute("role","button"),c.setAttribute("data-active","true"),c.setAttribute("tabindex","0"),c.setAttribute("role","button"),c.setAttribute("data-active","false"),h){c.setAttribute("aria-label",h);let e=document.createElement("label");e.innerHTML=h,c.appendChild(e)}c.addEventListener("mousedown",e=>{e.stopPropagation(),e.preventDefault()}),c.addEventListener("touchstart",e=>{e.stopPropagation(),e.preventDefault()}),c.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault()}),c.addEventListener("keydown",e=>{if("Enter"===e.key){e.stopPropagation(),e.preventDefault();let t=new o.Rect(l.x-.1,l.y-.1,l.width+.2,l.height+.2);null==f||f.viewport.fitBounds(t,!1)}}),c.addEventListener("focus",()=>{c.setAttribute("data-active","true")}),c.addEventListener("mouseover",()=>{c.setAttribute("data-active","true")}),c.addEventListener("mouseout",()=>{c.removeAttribute("data-active")}),c.addEventListener("blur",()=>{c.removeAttribute("data-active")}),null==f||f.addOverlay(c,l,o.Placement.CENTER)}}),x())},[u,e]),l.createElement(ex,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":i.id,hasNavigator:i.showNavigator},l.createElement(eZ,{_cloverViewerHasPlaceholder:n,config:i}),i.showNavigator&&l.createElement(eS,{id:i.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),l.createElement(ew,{id:i.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...t&&{"aria-label":t}}))},eY=({_cloverViewerHasPlaceholder:e=!1,annotations:t,body:i,instanceId:r,isTiledImage:n=!1,label:a,src:o="",openSeadragonCallback:s,openSeadragonConfig:c={}})=>{let u=r??eE(),d="string"==typeof a?a:((e,t="none",i=", ")=>{let r=((e,t="none")=>{if(!e)return null;if("string"==typeof e)return[e];if(!e[t]){let t=Object.getOwnPropertyNames(e);if(t.length>0)return e[t[0]]}return e[t]&&Array.isArray(e[t])?e[t]:null})(e,t);return Array.isArray(r)?r.join(`${i}`):r})(a),h={...function(e){return{id:`openseadragon-${e}`,navigatorId:`openseadragon-navigator-${e}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${e}`,homeButton:`reset-${e}`,rotateLeftButton:`rotateLeft-${e}`,rotateRightButton:`rotateRight-${e}`,zoomInButton:`zoomIn-${e}`,zoomOutButton:`zoomOut-${e}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}}}(u),...c},p=Array.isArray(i)?i:i?[i]:[],f=Array.isArray(o)?o:o?[o]:[],g=[],m=y.SimpleImage;if(p.length){let e=p.map(v);g=e.map(e=>e.uri).filter(Boolean),m=e.some(e=>e.imageType===y.TiledImage)?y.TiledImage:y.SimpleImage}else if(f.length){let e=f.map(e=>({uri:e,imageType:n?y.TiledImage:y.SimpleImage}));g=e.map(e=>e.uri).filter(Boolean),m=e.some(e=>e.imageType===y.TiledImage)?y.TiledImage:y.SimpleImage}return g.length?l.createElement(w,{FallbackComponent:eb},l.createElement(eX,{_cloverViewerHasPlaceholder:e,annotations:t,ariaLabel:d,config:h,imageType:m,key:u,uri:g,openSeadragonCallback:e=>{null==s||s(e)}})):null};var e0=i(51633),e1=i(60088),e2=i(64832),e3=i(95449);let e6=e=>{var t,i,r,n,a;let o={id:"string"==typeof e?e:e.source};if("string"==typeof e){if(e.includes("#xywh=")){let t=e.split("#xywh=");if(t&&t[1]){let[e,i,r,n]=t[1].split(",").map(e=>Number(e));o={id:t[0],rect:{x:e,y:i,w:r,h:n}}}}else if(e.includes("#t=")){let t=e.split("#t=");t&&t[1]&&(o={id:t[0],t:t[1]})}}else if("object"==typeof e){if((null==(t=e.selector)?void 0:t.type)==="PointSelector")o={id:e.source,point:{x:e.selector.x,y:e.selector.y}};else if((null==(i=e.selector)?void 0:i.type)==="SvgSelector")o={id:e.source,svg:e.selector.value};else if((null==(r=e.selector)?void 0:r.type)==="FragmentSelector"&&null!=(n=e.selector)&&n.value.includes("xywh=")&&"Canvas"==e.source.type&&e.source.id){let t=null==(a=e.selector)?void 0:a.value.split("xywh=");if(t&&t[1]){let[i,r,n,a]=t[1].split(",").map(e=>Number(e));o={id:e.source.id,rect:{x:i,y:r,w:n,h:a}}}}}return o},e4=window.OpenSeadragon;if(!e4&&!(e4=o))throw Error("OpenSeadragon is missing.");let e5="http://www.w3.org/2000/svg";e4.Viewer&&(e4.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo||(this._svgOverlayInfo=new e8(this)),this._svgOverlayInfo});let e8=function(e){let t=this;this._viewer=e,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(e5,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(e5,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){t.resize()}),this._viewer.addHandler("open",function(){t.resize()}),this._viewer.addHandler("rotate",function(){t.resize()}),this._viewer.addHandler("flip",function(){t.resize()}),this._viewer.addHandler("resize",function(){t.resize()}),this.resize()};e8.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));let e=this._viewer.viewport.pixelFromPoint(new e4.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0),i=this._viewer.viewport.getRotation(),r=this._viewer.viewport.getFlip(),n=this._viewer.viewport._containerInnerSize.x,a=n*t,o=a;r&&(a=-a,e.x=-e.x+n),this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+a+","+o+") rotate("+i+")")},onClick:function(e,t){new e4.MouseTracker({element:e,clickHandler:t}).setTracking(!0)}};let e9={parseAnnotationTarget:e6,createOpenSeadragonRect:function(e,t,i){let r,n,a=40,s=40;t.rect&&(r=t.rect.x,n=t.rect.y,a=t.rect.w,s=t.rect.h),t.point&&(r=t.point.x,n=t.point.y),e6.svg;let l=1/e.width;return new o.Rect(r*l-a*l/2*(i-1),n*l-s*l/2*(i-1),a*l*i,s*l*i)}},e7=e3.default},71726:(e,t,i)=>{i.d(t,{n:()=>tt});var r=i(31458),n=i(15867);let a=function(e){return function(){let t={type:e,getType:()=>e,toString:()=>e};return(e,i)=>({...t,...void 0!==e&&{payload:e},...void 0!==i&&{meta:i}})}},o="@iiif/IMPORT_ENTITIES",s="@iiif/MODIFY_ENTITY_FIELD",l="@iiif/REORDER_ENTITY_FIELD",c="@iiif/MOVE_ENTITY",u="@iiif/MOVE_ENTITIES",d="@iiif/ADD_REFERENCE",h="@iiif/UPDATE_REFERENCE",p="@iiif/CHANGE_REFERENCE_IDENTIFIER",f="@iiif/REMOVE_REFERENCE",g="@iiif/ADD_METADATA",m="@iiif/REMOVE_METADATA",y="@iiif/UPDATE_METADATA",v="@iiif/REORDER_METADATA",b=a(o)(),S=a(s)(),w=(a(l)(),a(c)(),a(u)(),a(d)(),a(f)(),a(h)(),a(p)(),a(g)(),a(y)(),a(m)(),a(v)(),{modifyEntityField:S}),x="@iiif/ADD_MAPPING",C="@iiif/ADD_MAPPINGS",R=a(x)(),A=a(C)(),E="RESOURCE_ERROR",k="RESOURCE_LOADING",I="RESOURCE_READY",O="@iiif/REQUEST_RESOURCE",_="@iiif/REQUEST_ERROR",T="@iiif/REQUEST_MISMATCH",P="@iiif/REQUEST_COMPLETE",M="@iiif/REQUEST_OFFLINE_RESOURCE",$=a(O)(),j=a(_)(),L=a(T)(),F=a(P)(),B=(a(M)(),"@iiif/BATCH"),z="@iiif/BATCH_IMPORT",D=a(B)();a(z)();let N="@iiif/SET_META_VALUE",W="@iiif/SET_META_VALUE_DYNAMIC",H="@iiif/UNSET_META_VALUE",U={setMetaValue:a(N)(),setMetaValueDynamic:a(W)(),unsetMetaValue:a(H)()};var V=i(62086);function q(e){return"string"!=typeof e&&(e&&!e.type&&"source"in e?(e.type="SpecificResource",!0):!!e&&"SpecificResource"===e.type)}function J(...e){return t=>e.reduce((e,t)=>t(e),t)}let Z=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];var Q=class e{constructor(e,t={}){(0,V.oX)(this,"traversals",void 0),(0,V.oX)(this,"options",void 0),(0,V.oX)(this,"_traverseManifest",J(this.traverseManifestItems.bind(this),this.traverseNavPlace.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseManifestStructures.bind(this),this.traverseInlineAnnotationPages.bind(this))),(0,V.oX)(this,"_traverseCanvas",J(this.traverseCanvasItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this),this.traverseInlineAnnotationPages.bind(this))),(0,V.oX)(this,"_traverseAnnotationPage",J(this.traverseAnnotationPageItems.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this))),(0,V.oX)(this,"_traverseRange",J(this.traverseRangeRanges.bind(this),this.traverseLinking.bind(this),this.traverseDescriptive.bind(this),this.traverseLinkedCanvases.bind(this))),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],specificResource:[],geoJson:[],...e},this.options={allowUndefinedReturn:!1,...t}}static all(t){return new e({collection:[t],manifest:[t],canvas:[t],annotationCollection:[t],annotationPage:[t],annotation:[t],contentResource:[t],choice:[t],range:[t],service:[t],geoJson:[t],specificResource:[t],agent:[t]})}traverseDescriptive(e){return e.thumbnail&&=(0,V.eC)(e.thumbnail).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.provider&&=e.provider.map(t=>this.traverseAgent(t,e)),e}traverseLinking(e){return e.seeAlso&&=(0,V.eC)(e.seeAlso).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.service&&=(0,V.eC)(e.service).map(e=>this.traverseService(e)),e.services&&=(0,V.eC)(e.services).map(t=>this.traverseService(t,e)),e.logo&&=(0,V.eC)(e.logo).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.homepage&&=(0,V.eC)(e.homepage).map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.partOf&&=e.partOf.map(t=>"string"!=typeof t&&t.type?"Canvas"===t.type?this.traverseType(t,{parent:e},this.traversals.canvas):"AnnotationCollection"===t.type?this.traverseType(t,{parent:e},this.traversals.annotationCollection):"Collection"===t.type?this.traverseType(t,{parent:e},this.traversals.collection):this.traverseType(t,{parent:e},this.traversals.contentResource):this.traverseType(t,{parent:e},this.traversals.contentResource)),e.start&&(q(e.start)?e.start=this.traverseSpecificResource(e.start,"Canvas",e):e.start=this.traverseType(e.start,{parent:e},this.traversals.canvas)),e.rendering&&=e.rendering.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e.supplementary&&=e.supplementary.map(t=>this.traverseType(t,{parent:e},this.traversals.contentResource)),e}traverseCollectionItems(e){return e.items&&e.items.map(e=>"Collection"===e.type?this.traverseCollection(e):this.traverseManifest(e)),e}traverseCollection(e,t){return this.traverseType(this.traverseDescriptive(this.traverseNavPlace(this.traverseInlineAnnotationPages(this.traverseLinking(this.traverseLinkedCanvases(this.traverseCollectionItems(e)))))),{parent:t},this.traversals.collection)}traverseGeoJson(e,t){return this.traverseType(e,{parent:t},this.traversals.geoJson)}traverseNavPlace(e){return e.navPlace&&=this.traverseGeoJson(e.navPlace,e),e}traverseManifestItems(e){return e.items&&=e.items.map(e=>this.traverseCanvas(e)),e}traverseManifestStructures(e){return e.structures&&=e.structures.map(e=>this.traverseRange(e)),e}traverseManifest(e,t){return this.traverseType(this._traverseManifest(e),{parent:t},this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(t=>this.traverseAnnotationPage(t,e)),e}traverseInlineAnnotationPages(e){return"string"!=typeof e&&e&&(e.annotations&&=e.annotations.map(t=>this.traverseAnnotationPage(t,e))),e}traverseCanvas(e,t){return this.traverseType(this._traverseCanvas(e),{parent:t},this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&=e.items.map(t=>this.traverseAnnotation(t,e)),e}traverseAnnotationPage(e,t){return this.traverseType(this._traverseAnnotationPage(e),{parent:t},this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(t=>this.traverseContentResource(t,e)):e.body&&=this.traverseContentResource(e.body,e),e}traverseLinkedCanvases(e){return e.placeholderCanvas&&=this.traverseCanvas(e.placeholderCanvas),e.accompanyingCanvas&&=this.traverseCanvas(e.accompanyingCanvas),e}traverseAnnotation(e,t){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(this.traverseDescriptive(e))),{parent:t},this.traversals.annotation)}traverseContentResourceLinking(e){return"string"==typeof e||!e||e&&e.service&&(e.service=(0,V.eC)(e.service||[]).map(t=>this.traverseService(t,e))),e}traverseContentResource(e,t){return"Choice"===e.type&&(e.items=e.items.map(t=>this.traverseContentResource(t,e))),q(e)?this.traverseSpecificResource(e,"ContentResource"):this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),{parent:t},this.traversals.contentResource)}traverseSpecificResource(e,t,i){let r=e.source;return"string"==typeof e.source&&(r={id:e.source,type:t||"unknown"}),this.traverseType({...e,source:"Canvas"===t||"Canvas"===r.type?this.traverseType(r,{parent:i},this.traversals.canvas):"ContentResource"===t?this.traverseContentResource(r,{parent:i}):this.traverseUnknown(r,{parent:i,typeHint:t})},{parent:i},this.traversals.specificResource)}traverseRangeRanges(e){return e.items&&=e.items.map(t=>"string"==typeof t?this.traverseCanvas({id:t,type:"Canvas"},e):q(t)?this.traverseSpecificResource(t,"Canvas",e):"Manifest"===t.type?this.traverseManifest(t,e):this.traverseRange(t,e)),e}traverseRange(e,t){return this.traverseType(this._traverseRange(e),{parent:t},this.traversals.range)}traverseAgent(e,t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),{parent:t},this.traversals.agent)}traverseType(e,t,i){return i.reduce((e,i)=>{let r=i(e,t);return void 0!==r||this.options.allowUndefinedReturn?r:e},e)}traverseService(e,t){let i=Object.assign({},e);return i&&i.service&&(i.service=(0,V.eC)(i.service).map(e=>this.traverseService(e))),this.traverseType(i,{parent:t},this.traversals.service)}traverseUnknown(e,{parent:t,typeHint:i}={}){let r=function(e,t){if(null==e)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw Error("Array is not a valid entity");if("object"!=typeof e){if(t)return t;throw Error(`${typeof e} is not a valid entity`)}if("string"==typeof e.type){let t=Z.indexOf(e.type);if(-1!==t)return Z[t]}if(e.profile)return"Service";throw Error("Resource type is not known")}(e,i);switch(r){case"Collection":return this.traverseCollection(e,t);case"Manifest":return this.traverseManifest(e,t);case"Canvas":return this.traverseCanvas(e,t);case"AnnotationPage":return this.traverseAnnotationPage(e,t);case"Annotation":return this.traverseAnnotation(e,t);case"ContentResource":return this.traverseContentResource(e,t);case"Range":return this.traverseRange(e,t);case"Service":return this.traverseService(e,t);case"Agent":return this.traverseAgent(e,t);default:throw Error(`Unknown or unsupported resource type of ${r}`)}}},K=i(62237);function G(e,t){let i=t||"unknown";if(!e)return;if("string"==typeof e)return{id:e,type:i};if(q(e))return G(e.source,t);let r=i&&"unknown"!==i?i:e.type||e["@type"],n=e.id||e["@id"];if(r&&-1!==r.indexOf(":")&&(r=r.split(":").pop()),n&&r)return{id:n,type:r}}let X={},Y="iiif-parser:hasPart",ee="iiif-parser:partOf",et="iiif-parser:isExternal",ei="__$UNSET$__",er="__$UNWRAP$__",en=[];function ea(e,t){if(t&&t["@explicit"]){let i={};for(let r of Object.keys(t))r!==ee&&"@explicit"!==r&&(function(e){if(e===X||0===Object.keys(e).length)return!0;for(let t in e)return!1;return!0}(t[r])?i[r]=e[r]:i[r]=t[r]);return i}return e}Object.freeze(en),Object.freeze(X);let eo={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:en,label:null,thumbnail:en,summary:null,requiredStatement:null,metadata:en,rights:null,provider:en,items:en,seeAlso:en,homepage:en,rendering:en,service:en},es={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:en,thumbnail:en,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:en,rights:null,navDate:null,provider:en,items:en,annotations:en,seeAlso:en,homepage:en,partOf:en,rendering:en,service:en,duration:0,height:0,width:0},el={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:en,thumbnail:en,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:en,rights:null,navDate:null,provider:en,items:en,annotations:en,seeAlso:en,homepage:en,partOf:en,rendering:en,service:en,services:en},ec={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:en,behavior:en,homepage:en,items:en,label:null,metadata:en,navDate:null,provider:en,partOf:en,accompanyingCanvas:null,placeholderCanvas:null,rendering:en,requiredStatement:null,rights:null,seeAlso:en,service:en,services:en,start:null,structures:en,summary:null,thumbnail:en,viewingDirection:"left-to-right"},eu={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:en,thumbnail:en,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:en,rights:null,navDate:null,provider:en,items:en,annotations:en,seeAlso:en,homepage:en,partOf:en,rendering:en,service:en,start:null,supplementary:null,viewingDirection:"left-to-right"},ed={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:en,seeAlso:en,homepage:en},eh={id:"https://iiif-parser/empty-service",type:"UnknownService"};function ep(e){var t;let[i,r]=(e||"").split("#");return r&&((t=r).includes("xywh=")||t.includes("t="))?[i,r]:[e||"",""]}function ef(e,t){if("string"==typeof e)return{id:e,type:t};if(!e.id)throw Error(`Invalid resource does not have an ID (${JSON.stringify(e)}, ${t})`);return e}function eg(e,t,i){if("string"==typeof e)return e;if(t.id!==e.id||t.type!==e.type){if("ImageService3"===t.type)return t;if("ImageService3"===e.type)return e;throw Error(`Can only merge entities with identical identifiers and type! ${t.type}(${t.id}) => ${e.type}(${e.id})`)}return function e(t,i,r){if(!i)return t;if(Array.isArray(t)){if(!Array.isArray(i))throw Error("Cannot merge array with non-array");let r=[...t];for(let n of i)if(n["@id"]&&!n.id&&(n.id=n["@id"]),n["@type"]&&!n.type&&(n.type=n["@type"]),null!=n)if(Array.isArray(n))r.push(n);else if("object"==typeof n&&n.id&&n.type){let t=r.findIndex(e=>e.id===n.id&&e.type===n.type);t>=0&&(r[t]=e(r[t],n))}else -1===t.indexOf(n)&&r.push(n);return r}if("object"==typeof t){if(Array.isArray(i)||"object"!=typeof i)throw Error("Cannot merge object with non-object");let n={...t},a=[],o=[],s=Object.keys(t).filter(e=>e!==Y&&"id"!==e&&"type"!==e),l={},c={};for(let[t,r]of Object.entries(i)){if(t===Y||"id"===t||"type"===t)continue;let i=n[t];i===r?o.push(t):i!==en&&i?(i&&r&&(l[t]=i,c[t]=r),n[t]=e(i,r),n[t]===l[t]&&(o.push(t),delete l[t])):(a.push(t),n[t]=r)}if(r&&(r.parent&&r.parent.id||r.isTopLevel)){let e=[],i={};if(r.parent?i[ee]=r.parent.id:r.isTopLevel&&(i[ee]=t.id),n[Y]&&n[Y].length){let t=!(n[Y]||[]).find(e=>e["@explicit"]),r=a.length>0||o.length!==s.length;if(t&&r)for(let t of n[Y]){let i={...t},r=Object.keys(l);if(i){for(let e of(i["@explicit"]=!0,s))e!==Y&&(i[e]=X);for(let e of r)i[e]=l[e]}e.push(i)}else e.push(...n[Y]);if(r){let e=Object.keys(c);for(let e of(i["@explicit"]=!0,a))i[e]=X;for(let e of o)i[e]=X;for(let t of e)i[t]=c[t]}}i.id=n.id,i.type=n.type,e.push(i),n[Y]=e}return n}return t?t:i}({...e},t,i)}function em(e){return t=>"string"==typeof t?{id:t,type:e}:t.id?t.type?t:{type:e,...t}:{id:`vault://${function(e){let t=JSON.stringify(e),i=5381,r=t.length;for(;r;)i=33*i^t.charCodeAt(--r);let n=(i>>>0).toString(16);return n.length%2?"0"+n:n}(t)}`,type:e,...t}}function ey(e){return t=>({...e,...t})}function ev(e){return Array.isArray(e)?e:[e]}function eb(e){return e.body&&=ev(e.body),e.seeAlso&&=ev(e.seeAlso),e.audience&&=ev(e.audience),e.accessibility&&=ev(e.accessibility),e.motivation&&=ev(e.motivation),e}function eS(e,{typeHint:t,partOfTypeHint:i}={}){if("string"==typeof e&&(e={id:e,type:t||"unknown"}),q(e))return"string"==typeof e.source&&(e.source={id:e.source,type:t||"unknown"}),"Canvas"===e.source.type&&e.source.partOf&&"string"==typeof e.source.partOf&&(e.source.partOf=[{id:e.source.partOf,type:i||"Manifest"}]),e;let r,[n,a]=ep(e.id);return e.id=n,a&&a&&(r={type:"FragmentSelector",value:a}),{type:"SpecificResource",source:e,selector:r}}function ew(e){let t=Object.assign({},e);return e&&e.items&&(t.items=e.items.map(e=>"string"==typeof e||"Canvas"===e.type?eS(e):e)),t}function ex(e){let t=Object.assign({},e);return t.start?(t.start=eS(t.start,{typeHint:"Canvas"}),t):e}function eC(e){let t=Object.assign({},e);return t.target?(t.target=function e(t,i={}){if(Array.isArray(t))return e(t[0]);if("string"==typeof t){let[e,r]=ep(t);return r?{type:"SpecificResource",source:{id:e,type:i.typeHint||"Unknown"},selector:{type:"FragmentSelector",value:r}}:{type:"SpecificResource",source:{id:e,type:i.typeMap&&i.typeMap[e]||i.typeHint||"Unknown"}}}if("Choice"===t.type||"List"===t.type||"Composite"===t.type||"Independents"===t.type)return e(t.items[0]);if(!t.type&&"source"in t&&(t.type="SpecificResource"),"SpecificResource"===t.type){"Canvas"===t.source.type&&t.source.partOf&&"string"==typeof t.source.partOf&&(t.source.partOf=[{id:t.source.partOf,type:"Manifest"}]);let r="string"==typeof t.source?t.source:t.source.id,[,n]=ep(r);if(n){let n=e(r,i);n&&(t.selector=n.selector,t.source=n.source)}return t.selector?{...t,type:"SpecificResource",source:t.source,selector:t.selector}:{...t,type:"SpecificResource",source:t.source}}if(t.id){"Canvas"===t.type&&t.partOf&&"string"==typeof t.partOf&&(t.partOf=[{id:t.partOf,type:"Manifest"}]);let[e,i]=ep(t.id);return i?{type:"SpecificResource",source:{...t,id:e},selector:{type:"FragmentSelector",value:i}}:{type:"SpecificResource",source:{...t,id:e}}}return{type:"SpecificResource",source:t}}(t.target,{typeHint:"Canvas"}),t):e}function eR(e){return e}function eA(e){return void 0===e.items&&(e[et]=!0),e}function eE(e,{allowSourceString:t=!0,allowString:i=!1,allowedStringType:r}={}){let n=e=>{if(t&&e&&e.source&&"string"!=typeof e.source){let t=Object.keys(e.source);if(e.source.id&&e.source.type&&2===t.length)return{...e,source:e.source.id}}return e};if(e){if(e.source&&e.source.partOf)return n(e);let t=Object.keys(e);if(2===t.length&&e.type&&e.source||3===t.length&&e.type&&e.source&&-1!==t.indexOf("selector")&&!e.selector)return i&&(!r||r===e.source.type)?e.source.id:"ContentResource"===e.source.type?{type:"SpecificResource",source:e.source.id}:e.source;if(e.selector&&!Array.isArray(e.selector)&&"string"!=typeof e.selector&&"FragmentSelector"===e.selector.type){let t=`${e.source.id}#${e.selector.value}`;return i?t:{id:t,type:e.source.type}}}return n(e)}function ek(e){if(!e)return;let t=Object.keys(e);if(0!==t.length){if(1===t.length){let i=t[0];if(!i)return"";let r=(e[i]||[]).join("");return"@none"===i||"none"===i||"en"===i?r:{"@language":i,"@value":r}}return t.map(t=>({"@language":t,"@value":(e[t]||[]).join("")}))}}function eI(e,t=!1){if(e)return e.length>1&&!t?e:e[0]||void 0}function eO(e){if(e){if("string"==typeof e)return{"@id":e};if("@id"in e){let t={...e};return delete t["@type"],t}return{"@context":"http://iiif.io/api/image/2/context.json","@id":e.id,profile:`http://iiif.io/api/image/2/profiles/${e.profile}.json`}}}function e_(e,t){return[["@id",e.id],["@type",t],["format",e.format],["height",e.height],["width",e.width],["viewingDirection","left-to-right"===e.viewingDirection?void 0:e.viewingDirection],["license",e.license?e.license:void 0]]}function*eT(e){let t=e.provider?yield e.provider[0]:void 0;return[["label",ek(e.label)],["metadata",e.metadata&&e.metadata.length?e.metadata.map(e=>({label:ek(e.label)||"",value:ek(e.value)||""})):void 0],["description",ek(e.summary)],["thumbnail",eI((yield e.thumbnail))],["navDate",e.navDate],["logo",t?eI(t.logo):void 0],["homepage",t?t.homepage:void 0],["attribution",e.requiredStatement?ek(e.requiredStatement.value):void 0]]}function*eP(e){let t=e.start&&e.start.type&&"SpecificResource"===e.start.type?eE(e.start):e.start;return[["seeAlso",eI((yield e.seeAlso))],["service",eI((e.service||[]).map(eO))],["rendering",eI((yield e.rendering))],["startCanvas",t?t.id:void 0]]}let eM={Manifest:function*(e,t,{isTopLevel:i}){return[...i?[["@context","http://iiif.io/api/presentation/2/context.json"]]:[],...e_(e,"sc:Manifest"),...yield*eT(e),...yield*eP(e),["sequences",[{"@id":`${e.id}/sequence0`,"@type":"sc:Sequence",canvases:yield e.items}]],["structures",(yield e.structures)]]},Canvas:function*(e){let t=(yield e.items)[0];return[...e_(e,"sc:Canvas"),...yield*eT(e),...yield*eP(e),["images",t?[t.resources]:void 0],["annotations",e.annotations&&e.annotations.length?eI((yield e.annotations)):void 0]]},AnnotationPage:function*(e){return[...e_(e,"sc:AnnotationList"),...yield*eT(e),["resources",e.items&&e.items.length?eI((yield e.items)):void 0]]},Annotation:function*(e){return[["@id",e.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",function e(t){return Array.isArray(t)?t.map(t=>e(t)):"string"==typeof t?t:t.type&&"Canvas"===t.type?t.id:t}(e.target)],["resource",eI((yield e.body),!0)]]},ContentResource:function*(e){return"Image"===e.type?[...e_(e,"dctypes:Image"),...yield*eT(e),...yield*eP(e)]:[...e_(e,void 0),...yield*eT(e)]},AnnotationCollection:function*(e){return[["@id",e.id],["@type","sc:Layer"],["label",ek(e.label)]]},Collection:function*(e){return[...e_(e,"sc:Collection"),...yield*eT(e),...yield*eP(e),["members",(yield*e.items)]]},Range:function*(e){let t=[],i=[];if(e.items)for(let r of e.items){let n="SpecificResource"===r.type?r.source:r;if(n){let a=yield n;t.push({"@id":function(e){if(e&&"SpecificResource"===e.type){let t=e.id,i=e.selector?Array.isArray(e.selector)?e.selector[0]:e.selector:void 0;return i&&"FragmentSelector"===i.type&&(t+="#"+i.value),t}return e?.id}(r),"@type":n.type,label:a?a.label:void 0,within:e.id}),"Canvas"===n.type&&i.push(n.id)}}return[...e_(e,"sc:Range"),...yield*eT(e),...yield*eP(e),["canvases",i.length===t.length?i:void 0],["members",i.length===t.length?void 0:t]]}};function e$(e){return[["id",e.id?.startsWith("vault://")?void 0:e.id],["type",e.type],["format",e.format],["profile",e.profile],["height",e.height||void 0],["width",e.width||void 0],["duration",e.duration||void 0],["viewingDirection","left-to-right"===e.viewingDirection?void 0:e.viewingDirection],["behavior",e.behavior&&e.behavior.length?e.behavior:void 0],["timeMode",e.timeMode],["motivation",Array.isArray(e.motivation)?e.motivation[0]:e.motivation],[Y,ei]]}function ej(e){if(e===ei||!e||0===e.length)return;let t=e.filter(e=>e!==ei);if(0!==t.length)return t}function eL(e){if(e&&e.type&&"ImageService2"===e.type){let{id:t,type:i,profile:r,...n}=e,a="string"==typeof r?r:Array.isArray(r)?r.find(e=>"string"==typeof e):"";return{"@id":t,"@type":i,profile:a?a.startsWith("http")?a:`http://iiif.io/api/image/2/${a}.json`:"http://iiif.io/api/image/2/level0.json",...n}}return e}function eF(e){if(Array.isArray(e)||(e=e?[e]:[]),!(!e||0===e.length))return e.map(eL)}function*eB(e){return[["label",e.label],["metadata",ej(e.metadata)],["summary",e.summary],["requiredStatement",e.requiredStatement],["rights",Array.isArray(e.rights)?e.rights[0]||void 0:e.rights||void 0],["navDate",e.navDate],["language",e.language],["thumbnail",ej((yield e.thumbnail))],["placeholderCanvas",(yield e.placeholderCanvas)],["accompanyingCanvas",(yield e.accompanyingCanvas)],["provider",ej((yield e.provider))]]}function*ez(e,t){let i=[];for(let r of e.partOf||[])("Manifest"!==r.type||"Manifest"!==t.type)&&i.push((yield r));return[["seeAlso",ej((yield e.seeAlso))],["service",ej(eF(e.service))],["services",ej(eF(e.services))],["rendering",ej((yield e.rendering))],["supplementary",ej((yield e.supplementary))],["homepage",ej((yield e.homepage))],["logo",ej((yield e.logo))],["partOf",ej(i)],["start",e.start?eE(e.start):e.start]]}let eD={Manifest:function*(e,t,{isTopLevel:i}){if(!i)return[...e$(e),...yield*eB(e),["navPlace",e.navPlace]];let r="http://iiif.io/api/presentation/3/context.json";return(e.navPlace||eN(e))&&(r=["http://iiif.io/api/presentation/3/context.json","http://iiif.io/api/extension/navplace/context.json"]),[["@context",e["@context"]?e["@context"]:r],...e$(e),...yield*eB(e),...yield*ez(e),["items",(yield e.items)],["structures",ej((yield e.structures))],["annotations",ej((yield e.annotations))],["navPlace",e.navPlace]]},Canvas:function*(e,t,{parent:i}){return i&&"Manifest"!==i.type&&"Canvas"!==i.type?[["id",e.id]]:[...e$(e),...yield*eB(e),...yield*ez(e,i),["items",(yield e.items)],["annotations",ej((yield e.annotations))],["navPlace",e.navPlace]]},Agent:function*(e){return[["id",e.id],["type","Agent"],["label",e.label],...yield*ez(e)]},AnnotationPage:function*(e){let t=Object.entries(e).map(([e,t])=>[e,Array.isArray(t)?ej(t):t]).filter(([e,t])=>"items"!==e&&"id"!==e&&e!==Y&&e!==ee&&e!==et),i=yield e.items;return[["id",e.id?.startsWith("vault://")?void 0:e.id],...t,...yield*ez(e),["items",i.length||!1===e[et]?i:ei]]},Service:function*(e){return[[er,eL(e)]]},Annotation:function*(e){let t=Object.entries(e).map(([e,t])=>"motivation"===e?[e,Array.isArray(t)?t[0]:t]:"target"===e?[e,eE(t,{allowString:!0,allowSourceString:!0,allowedStringType:"Canvas"})]:[e,Array.isArray(t)?ej(t):t]).filter(([e])=>"body"!==e&&e!==Y&&e!==et),i;if(Array.isArray(e.body)){let t=[];for(let i of e.body)if(i&&q(i)){let e={...i};"Canvas"===i.source.type?e.source=i.source:e.source=yield i.source,t.push(eE(e,{allowSourceString:!0}))}else t.push((yield i));i=t}else e.body&&q(e.body)?(i={...e.body}).source=yield e.body.source:i=yield e.body;return[...t,...yield*eB(e),...yield*ez(e),["body",1===i.length?i[0]:i]]},ContentResource:function*(e){var t=[...e$(e),...yield*eB(e),...yield*ez(e),["annotations",ej((yield e.annotations))],["items",ej((yield e.items))]],i=e;let r=Object.keys(i),n=t.map(([e])=>e);for(let e of r)e!==Y&&e!==et&&-1===n.indexOf(e)&&void 0!==i[e]&&t.push([e,i[e]]);return t},AnnotationCollection:function*(e){return[["id",e.id],["type","AnnotationCollection"],["label",e.label]]},Collection:function*(e,t,{isTopLevel:i}){if(i){let t="http://iiif.io/api/presentation/3/context.json";return(e.navPlace||eN(e))&&(t=["http://iiif.io/api/extension/navplace/context.json","http://iiif.io/api/presentation/3/context.json"]),[["@context",t],...e$(e),...yield*eB(e),...yield*ez(e),["items",ej((yield e.items))],["navPlace",e.navPlace]]}return[...e$(e),...yield*eB(e),["navPlace",e.navPlace]]},Range:function*(e){let t=[];for(let i of e.items)"Range"===i.type?t.push((yield i)):i&&"SpecificResource"===i.type?t.push(eE(i)):t.push(i);return[...e$(e),...yield*eB(e),...yield*ez(e),["items",t],["annotations",ej((yield e.annotations))],["navPlace",e.navPlace]]}};function eN(e){if(!e.items||!Array.isArray(e.items))return!1;for(let t of e.items)if(t.navPlace)return!0;return!1}let eW=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function eH(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){var i,r;if(!((i=e[n])===(r=t[n])||eW(i)&&eW(r)))return!1}return!0}function eU(e,t,i){let r=e.iiif.requests[t],n=e.iiif.mapping[t];if(!n||!e.iiif.entities[n][r.resourceUri])return;let a=e.iiif.entities[n][r.resourceUri];return a&&a[Y]?ea(a,a[Y].find(e=>i?e[ee]===i.id:e[ee]===a.id)):a}function eV(e,t,{waitTimeout:i=30}={}){return(r,n,a)=>{let o=e.getStore(),s=o.getState(),l=s.iiif.requests[r];if(l){if(l.loadingState===I){let e=eU(s,r);if(e)return e}switch(l.loadingState){case E:break;case k:return(async()=>{let e,t=!1;try{let n=await Promise.race([new Promise((i,n)=>{t||(e=o.subscribe(()=>{let e=o.getState();if(e.iiif.requests[r].loadingState===E)return void n();if(e.iiif.requests[r].loadingState===I){let t=eU(e,r);t?i(t):n()}}))}),new Promise((e,r)=>setTimeout(()=>{t=!0,r()},60*i*1e3))]);if(e&&e(),n)return n}catch{e&&e()}})()}}e.dispatch($({id:r}));let c=t=>{if(!t)return;t.id||t["@id"]||(t["@type"]&&(t["@id"]=r),t.id=r);let i=((e,t)=>{let{entities:i,resource:r,mapping:n}=function(e){let t=(0,K.G$)(e),i={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},r={},n=(e,r)=>{let n=i[e]?i[e]:{};return(i,a)=>{let o=ef(i,r||e);return o&&o.id&&e?(n[o.id]=n[o.id]?eg(n[o.id],o,{parent:a.parent,isTopLevel:t.id===o.id}):eg({id:o.id,type:o.type},o,{parent:a.parent,isTopLevel:t.id===o.id}),{id:o.id,type:"ContentResource"===e?e:o.type}):o}},a=(e,t)=>i=>{let{id:n,type:a}=ef(i,t||e);if(void 0===n)throw Error("Found invalid entity without an ID.");return"ContentResource"===e||"Service"===e?r[n]=e:r[n]=a,i},o=new Q({collection:[eA,ey(el),a("Collection"),n("Collection")],manifest:[eA,ey(ec),ex,a("Manifest"),n("Manifest")],canvas:[ey(es),a("Canvas"),n("Canvas")],annotationPage:[eA,em("AnnotationPage"),ey(eo),a("AnnotationPage"),n("AnnotationPage")],annotation:[em("Annotation"),eb,eC,a("Annotation"),n("Annotation")],contentResource:[em("ContentResource"),a("ContentResource"),n("ContentResource")],range:[ey(eu),ew,a("Range","Canvas"),n("Range","Canvas")],agent:[ey(ed),a("Agent"),n("Agent")],specificResource:[eR],service:[e=>{i.Service=i.Service?i.Service:{};let t=e.id||e["@id"],r=function(e){let t=Object.assign({},e);if(t["@id"]&&(t.id=t["@id"]),t["@type"]&&(t.type=t["@type"]),t.service){let e=[];for(let i of(t.service=Array.isArray(t.service)?t.service:[t.service],t.service))e.push({id:i["@id"]||i.id,type:i["@type"]||i.type});t.service=e}return Object.assign({},eh,t)}(e);return r&&r.id&&(i.Service[r.id]?i.Service[t]=eg(i.Service[t],r):i.Service[t]=r),e}]}).traverseUnknown(t);return{entities:i,resource:o,mapping:r}}(t);if(void 0===r.id)return[j({id:e,message:"ID is not defined in resource."})];let a=[b({entities:i}),A({mapping:n})];return r.id!==e&&(a.push(R({id:e,type:r.type})),a.push(L({requestId:e,actualId:r.id}))),a.push(F({id:e})),a})(r,t);return e.dispatch(D({actions:i})),eU(o.getState(),r)};try{let i=t(r,n);return i&&"function"==typeof i.then?(async()=>{try{let e=await i;return a&&(e=a(e)),c(e)}catch(t){throw e.dispatch(j({id:r,message:t.toString()})),t}})():c(a?a(i):i)}catch(t){throw e.dispatch(j({id:r,message:t.toString()})),t}}}var eq=i(8576);function eJ(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}let eZ=new Map,eQ=e=>{let t=eZ.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},eK=(e,t)=>{let i;try{i=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==i&&t(i)};function eG(e,t,i,r){return!(!e[i]||!e[i][t]||!e[i][t][r]||!Array.isArray(e[i][t][r]))}function eX(e){return e.payload||{}}function eY(e,t){if(!(!t?.id||!t?.type))return e[t.type]?.[t.id]}function e0(e,t){return void 0===e?t:e}let e1=(e=eJ(),t)=>{let i=(i,r)=>({...e,[eX(t).type]:{...e[eX(t).type],[eX(t).id]:{...i,...r}}});switch(t.type){case s:{if(!e[eX(t).type]||!e[eX(t).type][eX(t).id])return e;let r=e[eX(t).type][eX(t).id];return"string"==typeof r?e:i(r,{[eX(t).key]:eX(t).value})}case l:{if(!eG(e,eX(t).id,eX(t).type,eX(t).key))return e;let r=e[eX(t).type][eX(t).id];if("string"==typeof r)return e;let n=Array.from(r[eX(t).key]),[a]=n.splice(eX(t).startIndex,1);return n.splice(eX(t).endIndex,0,a),i(r,{[eX(t).key]:n})}case u:{let i=eX(t).subjects,r=eX(t).from,n=eX(t).to||r,a=eY(e,r),o=n?.key||r.key;if(!eG(e,r.id,r.type,r.key)||!eG(e,n.id,n.type,n.key))return e;let s=[],l=[];if("slice"===i.type){let e=i.startIndex,t=i.length;l=(s=Array.from(a[r.key])).splice(e,t)}else{let e=Array.from(a[r.key]);for(let t of i.items){let i=function(e,t,i){if(!e[t]||!Array.isArray(e[t]))return null;let r=void 0===i.index?e[t].findIndex(e=>!!e&&G(e)?.id===i.id):i.index;return -1===r?null:{entity:e[t][r],index:r}}(a,r.key,t);i&&(l.push(i.entity),e[i.index]=null),s=e.filter(e=>null!==e)}}let c={...a,[r.key]:s},u={...e,[r.type]:{...e[r.type],[r.id]:c}},d=eY(u,n);if(!d)return e;let h=n?.index===void 0?d[o].length:n.index,p=Array.from(d[n.key]);p.splice(h,0,...l);let f={...d,[o]:p};return{...u,[n.type]:{...u[n.type],[n.id]:f}}}case c:return e1(e,{type:u,payload:{subjects:{type:"list",items:[eX(t).subject]},from:eX(t).from,to:eX(t).to}});case p:{let{id:r,index:n,key:a,newIdentifier:o,reference:s,type:l}=eX(t),c=e[l][r],u=G(s);if(!c||!c[a]||!u||n<0)return e;let d=c[a],h=d[n],p=e[u.type]?.[u.id];if(!p||!h)return e;let f=function(e,t){return q(e)?"string"==typeof e.source?{...e,source:t}:{...e,source:{...e.source||{},id:t}}:{...e,id:t}}(h,o),g=Array.from(d);g.splice(e0(n,g.length+1),1,f);let m=i(c,{[a]:g}),y={...p,id:o};y["iiif-parser:hasPart"]&&(y["iiif-parser:hasPart"]=y["iiif-parser:hasPart"].filter(e=>e["iiif-parser:partOf"]===r).map(e=>({...e,id:o})));let v={...m[u.type],[o]:y};return m[u.type]=v,m}case o:{let i=Object.keys(eX(t).entities),r={...e};for(let n of i){let i=eX(t).entities[n],a={...e[n]||{}},o=!1,s=Object.keys(i||{})||[];if(i&&s){for(let t of s)o=!0,a[t]=e[n][t]?function(e,t){let i={},r=[];for(let[n,a]of Object.entries(e||{})){r.push(n);let e=(t||{})[n];if(!e||0===e.length){i[n]=a;continue}i[n]=e}for(let[e,n]of Object.entries(t||{}))-1===r.indexOf(e)&&(i[e]=n);return i}(e[n][t],i[t]):i[t];o&&(r[n]=a)}}return r}case d:{if(!eG(e,eX(t).id,eX(t).type,eX(t).key))return e;let r=e[eX(t).type][eX(t).id],n=Array.from(r[eX(t).key]);return n.splice(e0(eX(t).index,n.length+1),0,eX(t).reference),i(r,{[eX(t).key]:n})}case h:case f:{if(!eG(e,eX(t).id,eX(t).type,eX(t).key))return e;let r=e[eX(t).type][eX(t).id],n=Array.from(r[eX(t).key]),a=e0(eX(t).index,n.findIndex(e=>e&&e.id===eX(t).reference.id));return -1===a||n[a]?.id!==eX(t).reference.id?e:(t.type===h?n.splice(a,1,eX(t).reference):n.splice(a,1),i(r,{[eX(t).key]:n}))}case g:{let r=e[eX(t).type][eX(t).id];if(!r)return e;let n=Array.from(r.metadata||[]),a=eX(t);return n.splice(e0(t.payload.beforeIndex,n.length+1),0,{label:a.label,value:a.label}),i(r,{metadata:n})}case v:{let r=e[eX(t).type][eX(t).id];if("string"==typeof r||!r)return e;let n=Array.from(r.metadata||[]),[a]=n.splice(eX(t).startIndex,1);return n.splice(eX(t).endIndex,0,a),i(r,{metadata:n})}case y:case m:{let r=e[eX(t).type][eX(t).id],n=Array.from(r.metadata||[]),a=eX(t).atIndex;return void 0!==a&&-1!==a&&n[a]?(t.type===y?n.splice(a,1,{label:eX(t).label,value:eX(t).value}):n.splice(a,1),i(r,{metadata:n})):e}default:return e}};function e2(e={}){let t=Object.keys(e);return function(i={},r){let n=!1,a={};for(let o=0;o<t.length;o++){let s=t[o];a[s]=e[s](i[s],r),n=n||a[s]!==i[s]}return n?a:i}}let e3=e2({mapping:(e={},t)=>{switch(t.type){case x:return{...e,[t.payload.id]:t.payload.type};case C:return{...e,...t.payload.mapping};default:return e}},entities:e1,requests:(e={},t)=>{switch(t.type){case O:case M:return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:k,uriMismatch:!1,resourceUri:t.payload.id}};case T:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case _:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:E,error:t.payload.message}};case P:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:I,error:void 0}}}return e},meta:(e={},t)=>{let{id:i,updateValue:r,value:n,meta:a,key:o}=t&&t.payload||{};switch(t.type){case N:return{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:n}}};case W:return{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:r(e[i]&&e[i][a]?e[i][a][o]:void 0)}}};case H:return e[i]&&e[i][a]&&e[i][a][o]?{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:void 0}}}:e;default:return e}}});function e6(e,t,i,r=!0){t[e8]=t[e8]||[],t[e8].push(e);let n=new Map;Object.defineProperty(t,e,{enumerable:r,get(){if(void 0===t[e4][e])return;let r=t[e4][e];if(!r)return r;let a=i.get(t[e4][e],{parent:this.id?{id:this.id,type:this.type}:void 0});return n.has(a)||(n.clear(),n.set(a,e7(a,i))),n.get(a)},set(r){t[e4][e]!==r&&(this[e5]?i.modifyEntityField({id:this.id,type:this.type},e,function e(t){return Array.isArray(t)?t.map(t=>e(t)):t&&t.type?{id:t.id,type:t.type}:t}(r)):this[e4][e]=r)}})}let e4=Symbol.for("_refs_"),e5=Symbol.for("_reactive_"),e8=Symbol.for("_defined_"),e9=Symbol.for("_parent_");function e7(e,t,i=!1,r){if(Array.isArray(e))return e.map(e=>e7(e,t,i));if(!e||!e.type||!e.id)return e;let n=Object.assign(Object.create(function(e,t=!1,i){let r={id:"",type:"unknown",[e8]:[],[e4]:{},[e9]:null,[e5]:null,is(e){return"string"==typeof e?this.id===e:!!e.id&&e.id===this.id},reactive(){if(!this[e5])return this[e5]=this.subscribe(()=>this.refresh(),!0),()=>{this.unreactive()}},refresh(){if(this.id){let e=this.unwrap();for(let t of Object.keys(e||{}))this[e8].includes(t)?this[e4][t]=e[t]:this[t]=e[t]}},unreactive(){this[e5]&&(this[e5](),this[e5]=null)},unwrap(){if(!this.id)throw Error("Invalid object");let t=this[e9];return e.get(this.id,{parent:t?{id:t,type:"unknown"}:void 0})},toPresentation3(){return e.toPresentation3(this.unwrap())},toPresentation2(){return e.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){return{...this,items:this.items,annotations:this.annotations,structures:this.structures,seeAlso:this.seeAlso,service:this.service,services:this.services,rendering:this.rendering,partOf:this.partOf,start:this.start,supplementary:this.supplementary,homepage:this.homepage,thumbnail:this.thumbnail,placeholderCanvas:this.placeholderCanvas,accompanyingCanvas:this.accompanyingCanvas,provider:this.provider}},subscribe(t,i=!0){return e.subscribe(()=>this.id?e.get(this.id):null,t,i)}};return e6("items",r,e),e6("annotations",r,e),e6("structures",r,e),e6("seeAlso",r,e),e6("rendering",r,e),e6("partOf",r,e),e6("start",r,e,!1),e6("supplementary",r,e),e6("homepage",r,e),e6("thumbnail",r,e),e6("placeholderCanvas",r,e,!1),e6("accompanyingCanvas",r,e,!1),e6("provider",r,e),e6("body",r,e),e6("logo",r,e),r}(t,i)),e);return i&&n.reactive(),n}function te(e){switch(e){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return e}var tt=class{constructor(e,t){(0,r.t)(this,"options",void 0),(0,r.t)(this,"store",void 0),(0,r.t)(this,"emitter",void 0),(0,r.t)(this,"isBatching",!1),(0,r.t)(this,"batchQueue",[]),(0,r.t)(this,"remoteFetcher",void 0),(0,r.t)(this,"staticFetcher",void 0),(0,r.t)(this,"defaultFetcher",e=>fetch(e).then(e=>{if(200===e.status)return e.json();{let t=Error(`${e.status} ${e.statusText}`);throw t.name="HTTPError",t}})),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||function(e={}){var t;let i,{enableDevtools:r=!1,iiifStoreName:n="iiif",defaultState:a={iiif:{entities:eJ(),meta:{},mapping:{},requests:{}}},customReducers:o={}}=e,s=(t=e2({[n]:e3,...o}),(e,i)=>i&&i.type===B?i.payload.actions.reduce(t,e):i&&i.type===z?{...e,iiif:{...e.iiif,...i.payload.state}}:t(e,i));return(0,eq.t)((i=("u">typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?(e,t={})=>(i,r,n)=>{let{enabled:a,anonymousActionType:o,store:s,...l}=t,c;try{c=(a??!0)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!c)return a&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(i,r,n);let{connection:u,...d}=((e,t,i)=>{if(void 0===e)return{type:"untracked",connection:t.connect(i)};let r=eZ.get(i.name);if(r)return{type:"tracked",store:e,...r};let n={connection:t.connect(i),stores:{}};return eZ.set(i.name,n),{type:"tracked",store:e,...n}})(s,c,l),h=!0;n.setState=(e,t,a)=>{let c=i(e,t);if(!h)return c;let d=void 0===a?{type:o||"anonymous"}:"string"==typeof a?{type:a}:a;return void 0===s?u?.send(d,r()):u?.send({...d,type:`${s}/${d.type}`},{...eQ(l.name),[s]:n.getState()}),c};let p=(...e)=>{let t=h;h=!1,i(...e),h=t},f=e(n.setState,r,n);if("untracked"===d.type?u?.init(f):(d.stores[d.store]=n,u?.init(Object.fromEntries(Object.entries(d.stores).map(([e,t])=>[e,e===d.store?f:t.getState()])))),n.dispatchFromDevtools&&"function"==typeof n.dispatch){let e=!1,t=n.dispatch;n.dispatch=(...i)=>{"__setState"!==i[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...i)}}return u.subscribe(e=>{switch(e.type){case"ACTION":if("string"!=typeof e.payload)return void console.error("[zustand devtools middleware] Unsupported action format");return eK(e.payload,e=>{if("__setState"===e.type){if(void 0===s)return void p(e.state);1!==Object.keys(e.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[s];return void(null==t||JSON.stringify(n.getState())!==JSON.stringify(t)&&p(t))}n.dispatchFromDevtools&&"function"==typeof n.dispatch&&n.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return p(f),void 0===s?u?.init(n.getState()):u?.init(eQ(l.name));case"COMMIT":if(void 0===s)return void u?.init(n.getState());return u?.init(eQ(l.name));case"ROLLBACK":return eK(e.state,e=>{if(void 0===s){p(e),u?.init(n.getState());return}p(e[s]),u?.init(eQ(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return eK(e.state,e=>{if(void 0===s)return void p(e);JSON.stringify(n.getState())!==JSON.stringify(e[s])&&p(e[s])});case"IMPORT_STATE":{let{nextLiftedState:t}=e.payload,i=t.computedStates.slice(-1)[0]?.state;if(!i)return;p(void 0===s?i:i[s]),u?.send(null,t);break}case"PAUSE_RECORDING":return h=!h}return}}),f}:(e,t)=>e)((e,t,i)=>(i.dispatch=t=>(e(e=>s(e,t),!1,t),t),i.dispatchFromDevtools=!0,{dispatch:(...e)=>i.dispatch(...e),...a}),{enabled:r}),(e,t,r)=>{let n=r.subscribe;return r.subscribe=(e,t,i)=>{let a=e;if(t){let n=i?.equalityFn||Object.is,o=e(r.getState());a=i=>{let r=e(i);if(!n(o,r)){let e=o;t(o=r,e)}},i?.fireImmediately&&t(o,o)}return n(a)},i(e,t,r)}))}({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=(0,n.t)(),this.remoteFetcher=eV(this,this.options.customFetcher),this.staticFetcher=eV(this,(e,t)=>t)}batch(e){this.isBatching=!0;try{e(this),this.isBatching=!1,this.dispatch(D({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.isBatching=!1,this.dispatch(D({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}modifyEntityField(e,t,i){this.dispatch(w.modifyEntityField({id:e.id,type:e.type,key:t,value:i}))}dispatch(e){if(this.isBatching)this.batchQueue.push(e);else{if(e.type===B){for(let t of e.payload.actions)this.emitter.emit(t.type,{action:t,state:this.store.getState()});this.store.dispatch(e);let t=this.getState();for(let i of e.payload.actions)this.emitter.emit(`after:${i.type}`,{action:i,state:t});return}this.emitter.emit(e.type,{action:e,state:this.store.getState()}),this.store.dispatch(e);let t=this.store.getState();this.emitter.emit(`after:${e.type}`,{action:e,state:t});return}}on(e,t){return this.emitter.on(e,t),()=>{this.emitter.off(e,t)}}serialize(e,t){var i=this.getState().iiif;if(!e.type||!e.id)throw Error("Unknown entity");if(!t[e.type])throw Error(`Serializer not found for ${e.type}`);return function r(n,a,o=0){let s=t[n.type];if(!s)return ei;if(o>20)throw Error("Circular reference: "+n.id+" "+n.type);let[l,c]=function e(t,i,r){let n=G(i);if(!n)return[void 0,void 0];let a=t.requests[n.id],o=n.type||t.mapping[n.id];if(!o||a&&a.resourceUri&&(!t.entities[o]||!t.entities[o][a.resourceUri]))return[void 0,void 0];let s=t.entities[o][a?a.resourceUri:n.id];if(n.type&&!s)return e(t,{id:n.id},r);if(s&&s[Y]){let e=s[Y].find(e=>r?e[ee]===r.id:e[ee]===s.id);return[ea(s,e),s]}return[s,s]}(i,n.type?n:n.id,a)||(n.id&&n.type?n:null);if(!l)return ei;let u=s(l,i,{parent:a,isTopLevel:e.id===n.id,fullResource:c}),d=u.next();for(;!d.done;){let e=d.value,t=ei;if(e)if(Array.isArray(e)){let i=[];for(let t of e)i.push(r(t,n,o+1));t=i}else t=r(e,n,o+1);d=u.next(t)}return d.value===ei?ei:function(e){let t={};for(let[i,r]of e){if(i===er&&r!==ei)return r;r!==ei&&null!=r&&(t[i]=r)}return t}(d.value)}(e)}toPresentation2(e){return this.serialize(e,eM)}toPresentation3(e){return this.serialize(e,eD)}hydrate(e,t,i={}){return this.get(e,t,{...i,skipSelfReturn:!1})}get(e,t,i={}){"string"!=typeof t&&(i=t||{},t=void 0);let{skipSelfReturn:r=!0}=i||{},n=i.parent?"string"==typeof i.parent?i.parent:i.parent.id:void 0;if(Array.isArray(e))return e.map(e=>this.get(e,i));let a=this.getState();if(q(e)&&!i.preserveSpecificResources&&(e=e.source),"string"==typeof e){let i=te(t||a.iiif.mapping[e]);if(!i)return r?null:{id:e,type:"unknown"};e={id:e,type:i}}if(e&&e.partOf&&!n&&!i.skipPartOfCheck){let t=Array.isArray(e.partOf)?e.partOf[0]:e.partOf;t&&("string"==typeof t&&(n=t),"string"==typeof t.id&&(n=t.id))}let o=te(t||e?.type),s=e?.id,l=a.iiif.entities[o];if(!l){let t=a.iiif.requests[s];return t&&t.resourceUri!==s?this.get(t.resourceUri,i):r?null:e}let c=l[e.id];return c&&c[Y]?ea(c,c[Y].find(e=>n?e[ee]===n:e[ee]===c.id)):l[e.id]||(r?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(e,t){if(void 0===e)return this.get(t,{skipSelfReturn:!1});if("function"==typeof e)try{let i=e(this.get(t,{skipSelfReturn:!1})),r=e=>this.deep(e,i);return r.size=Array.isArray(i)?i.length:1,r}catch{let e=e=>this.deep(e,void 0);return e.size=0,e}let i=t=>this.deep(t,e);return i.size=Array.isArray(e)?e.length:1,i}loadManifest(e,t,i){let r="string"==typeof e?e:e.id;return this.load(r,t,i)}loadCollection(e,t,i){let r="string"==typeof e?e:e.id;return this.load(r,t,i)}load(e,t,i){let r="string"==typeof e?e:e.id;return t?Promise.resolve(this.staticFetcher(r,t,i)):Promise.resolve(this.remoteFetcher(r,{},i))}loadSync(e,t,i){let r="string"==typeof e?e:e.id;return this.staticFetcher(r,t,i)}loadManifestSync(e,t,i){let r="string"==typeof e?e:e.id;return this.loadSync(r,t,i)}loadCollectionSync(e,t,i){let r="string"==typeof e?e:e.id;return this.loadSync(r,t,i)}areInputsEqual(e,t){return eH(e,t)}subscribe(e,t,i){return void 0===i&&(void 0===t||!1===t||!0===t)&&(i=t,t=e,e=e=>e),this.store.subscribe(e,e=>t(e,this),{equalityFn:eH,fireImmediately:!i})}async ensureLoaded(e){let t="string"==typeof e?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select(t=>t.iiif.requests[e])}getPaginationState(e){let t="string"==typeof e?e:e.id;if(!t)return null;let i=this.getResourceMeta(t,"@vault/pagination");if(i?.state)return i.state;let r=this.get(e);if(r.first){let e={currentPage:null,currentPageIndex:null,isFetching:!1,isFullyLoaded:!1,next:r.first,page:1,pages:[],previous:null,totalItems:r.total,currentLength:0};return this.setMetaValue([t,"@vault/pagination","state"],e),e}return null}async loadNextPage(e,t){let i,r="string"==typeof e?e:e.id;if(!r)return[null,null];let n=this.getPaginationState(e);if(!n||n.isFullyLoaded||!n.next)return[null,null];if(n.isFetching)return[n,null];let a="string"==typeof n.next?n.next:n.next.id,o=n.currentPage,s={...n,isFetching:!0};this.setMetaValue([r,"@vault/pagination","state"],s);try{i=await this.loadCollection(a,t,e=>{let{id:t,"@id":i,...r}=e||{};return i?{"@id":a,...r}:{id:a,...r}})}catch(t){let e={...n,isFetching:!1,error:t};return this.setMetaValue([r,"@vault/pagination","state"],e),[e,null]}if(!i){let e={...n,isFetching:!1,error:Error("Collection not found")};return this.setMetaValue([r,"@vault/pagination","state"],e),[e,null]}let l=this.get(r),c=[...l.items||[],...i.items||[]].map(e=>({id:e.id,type:e.type}));this.modifyEntityField({id:r,type:"Collection"},"items",c);let u=this.getPaginationState(e);if(!u)throw Error("Pagination state not found");let d={...u,isFetching:!1,error:null,currentPage:i.id,next:i.next?.id||null,currentPageIndex:u.pages.length,currentLength:c.length,pages:[...u.pages,{id:i.id,type:"Collection",startIndex:l.items.length,pageLength:i.items.length,order:"number"==typeof u.currentPageIndex?u.currentPageIndex+1:0}],isFullyLoaded:!i.next,previous:o,page:u.pages.length+1};return this.setMetaValue([r,"@vault/pagination","state"],d),[d,i]}getResourceMeta(e,t){let i=this.getState().iiif.meta[e];if(i)return t?i[t]:i}getObject(e,t,i={}){let{reactive:r,...n}=i;return e7(this.get(e,t,n),this,r)}async loadObject(e,t){return e7(await this.load(e,t),this)}async loadManifestObject(e,t){return e7(await this.loadManifest(e,t),this)}async loadCollectionObject(e,t){return e7(await this.loadCollection(e,t),this)}wrapObject(e){return e7(this.get(e,{skipSelfReturn:!1}),this)}isWrapped(e){return!!e[e8]}setMetaValue([e,t,i],r){this.dispatch("function"==typeof r?U.setMetaValueDynamic({id:e,meta:t,key:i,updateValue:r}):U.setMetaValue({id:e,meta:t,key:i,value:r}))}}},73382:(e,t,i)=>{i.d(t,{qX:()=>r.flushSync});var r=i(98477)},84676:(e,t,i)=>{i.r(t),i.d(t,{Children:()=>n.Children,Component:()=>n.Component,Fragment:()=>n.Fragment,Profiler:()=>n.Profiler,PureComponent:()=>n.PureComponent,StrictMode:()=>n.StrictMode,Suspense:()=>n.Suspense,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:()=>n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,act:()=>n.act,cloneElement:()=>n.cloneElement,createContext:()=>n.createContext,createElement:()=>n.createElement,createFactory:()=>n.createFactory,createRef:()=>n.createRef,default:()=>o,forwardRef:()=>n.forwardRef,isValidElement:()=>n.isValidElement,lazy:()=>n.lazy,memo:()=>n.memo,startTransition:()=>n.startTransition,unstable_act:()=>n.unstable_act,useCallback:()=>n.useCallback,useContext:()=>n.useContext,useDebugValue:()=>n.useDebugValue,useDeferredValue:()=>n.useDeferredValue,useEffect:()=>n.useEffect,useId:()=>n.useId,useImperativeHandle:()=>n.useImperativeHandle,useInsertionEffect:()=>n.useInsertionEffect,useLayoutEffect:()=>n.useLayoutEffect,useMemo:()=>n.useMemo,useReducer:()=>n.useReducer,useRef:()=>n.useRef,useState:()=>n.useState,useSyncExternalStore:()=>n.useSyncExternalStore,useTransition:()=>n.useTransition,version:()=>n.version});var r,n=i(14232);let a={...r||(r=i.t(n,2))};a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED={ReactCurrentOwner:{current:null}};let o=a}}]);